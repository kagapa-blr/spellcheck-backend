import{r as p,j as e}from"./react-87inLI7G.js";import{R as ie}from"./react-quill-new-P7oPFw6w.js";import{u as ne,a as ce,L as de}from"./index-BYwVeI31.js";import{g as ue,a as D,F as pe,h as ge,P as me,R as xe,i as he,U as fe,j as ye,k as we,I as be,b as je,l as X,m as ee,n as Ce,o as Ee,p as te}from"./@mui-BzP58hmc.js";import{F as Se}from"./file-saver-i-lmDZDm.js";import{m as Te}from"./quill-to-word-CqsuKUwa.js";import{Q as G}from"./quill-CZy4Qc3w.js";import{E as ve}from"./jspdf-cGIlQrZ8.js";import ke from"./html2canvas-CBrSDip1.js";import{g as De,c as Ne,a as Ae,r as We}from"./spellcheckApiService-RVhGhCuP.js";import{b as Re}from"./react-router-ri5stJUf.js";import"./@xmldom-DBEIMRBk.js";import"./lodash-BOf1oiLx.js";import"./react-dom-CosTHhxT.js";import"./scheduler-CzFDRTuY.js";import"./react-router-dom-Bk36vaWp.js";import"./@remix-run-CGjFHglr.js";import"./axios-CCb-kr4I.js";import"./@babel-CRFnVEoO.js";import"./fflate-EnPhvkmS.js";import"./react-is-DUDD-a5e.js";import"./clsx-B-dksMZM.js";import"./@emotion-Ca6BSwXP.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-YPZU7XtI.js";import"./react-transition-group-DGTJP9RM.js";import"./parchment-Crftfyop.js";import"./quill-delta-D6FENnLs.js";import"./fast-diff-Az_-rVRq.js";import"./lodash.clonedeep-Dbfj2Hht.js";import"./lodash.isequal-KULglXUe.js";import"./eventemitter3-DJ6nYskT.js";import"./lodash-es-BKPNmaDy.js";const _=o=>{const t=new Date,a=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear(),g=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${a}${i}${r}-${g}${n}.${o}`},Le=o=>{const t=document.createElement("div");t.innerHTML=o;const a=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),i=new Blob([a],{type:"text/plain;charset=utf-8"}),r=document.createElement("a");r.href=URL.createObjectURL(i),r.download=_("txt"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},ze=async o=>{if(!o){console.error("No content provided for Word download.");return}try{const t=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1"),a=document.createElement("div");a.style.display="none",document.body.appendChild(a);const i=new G(a,{theme:"snow"});i.clipboard.dangerouslyPasteHTML(t);const r=i.getContents(),g={exportAs:"blob"},n=await Te.generateWord(r,g);Se.saveAs(n,_("docx")),document.body.removeChild(a)}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},Ie=async o=>{try{if(!o)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const a=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=a,document.body.appendChild(t),setTimeout(async()=>{const i=await ke(t,{scale:2}),r=new ve,g=i.toDataURL("image/png"),n=r.internal.pageSize.getWidth(),T=r.internal.pageSize.getHeight(),s=10,m=n-2*s,C=i.height*m/i.width;if(C>T-2*s){const v=T-2*s,S=i.width*v/i.height;r.addImage(g,"PNG",s,s,S,v)}else r.addImage(g,"PNG",s,s,m,C);r.save(_("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},He=({text:o,quillRef:t,handleRefresh:a,handleReset:i})=>{const{language:r}=ne(),g={en:{downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",refresh:"Refresh",reset:"Reset",undo:"Undo",redo:"Redo",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",refresh:"ರಿಫ್ರೆಶ್",reset:"ಮರುಹೊಂದಿಸಿ",undo:"ಮರು ಕಾರ್ಯನಿರ್ವಹಣೆ",redo:"ಮರುಪಡೆಯಿರಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},n=g[r]||g.en,[T,s]=p.useState(!1),[m,C]=p.useState({open:!1,message:"",type:""}),[v,S]=p.useState([]),[k,A]=p.useState(-1),[I,W]=p.useState(!1),[R,H]=p.useState(!1),L=async(w,y)=>{if(!o||o.trim()===""||o==="<p><br></p>"){H(!0);return}s(!0);try{await y(),C({open:!0,message:n.downloadSuccess.replace("{type}",w),type:"success"})}catch{C({open:!0,message:n.downloadError.replace("{type}",w),type:"error"})}s(!1)},f=()=>C({...m,open:!1}),F=()=>{var y;const w=(y=t.current)==null?void 0:y.getEditor();w&&(w.history.undo(),k>0&&A(k-1))},z=()=>{var y;const w=(y=t.current)==null?void 0:y.getEditor();w&&(w.history.redo(),k<v.length-1&&A(k+1))},q=w=>{const y=v.slice(0,k+1);y.push(w),S(y),A(y.length-1)};p.useEffect(()=>{o&&q(o)},[o]);const M=()=>{var y;const w=(y=t.current)==null?void 0:y.getEditor();w&&(w.setText(""),S([]),A(-1)),W(!1)},O=()=>{W(!0)},U=()=>{M()},P=()=>{H(!1)};return e.jsxs("div",{className:"flex justify-end space-x-2 mb-3",children:[T&&e.jsx(ue,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"}),e.jsxs(D,{variant:"contained",title:n.downloadTxt,onClick:()=>L(".txt",()=>Le(o)),className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(pe,{fontSize:"small"}),e.jsx("span",{children:n.downloadTxt})]}),e.jsxs(D,{variant:"contained",title:n.downloadDocx,onClick:()=>L(".docx",()=>ze(o)),className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(ge,{fontSize:"small"}),e.jsx("span",{children:n.downloadDocx})]}),e.jsxs(D,{variant:"contained",title:n.downloadPdf,onClick:()=>L(".pdf",()=>Ie(o)),className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(me,{fontSize:"small"}),e.jsx("span",{children:n.downloadPdf})]}),e.jsxs(D,{variant:"contained",title:n.refresh,onClick:a,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(xe,{fontSize:"small"}),e.jsx("span",{children:n.refresh})]}),e.jsxs(D,{variant:"contained",title:n.reset,onClick:O,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:n.reset})]}),e.jsxs(D,{variant:"contained",title:n.undo,onClick:F,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(fe,{fontSize:"small"}),e.jsx("span",{children:n.undo})]}),e.jsxs(D,{variant:"contained",title:n.redo,onClick:z,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(ye,{fontSize:"small"}),e.jsx("span",{children:n.redo})]}),e.jsx(we,{open:m.open,autoHideDuration:3e3,onClose:f,message:m.message,action:e.jsx(be,{size:"small","aria-label":"close",color:"inherit",onClick:f,children:e.jsx(je,{fontSize:"small"})}),severity:m.type}),e.jsxs(X,{open:I,onClose:()=>W(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ee,{id:"alert-dialog-title",children:n.reset}),e.jsx(Ce,{children:e.jsx(Ee,{id:"alert-dialog-description",children:n.resetConfirmation})}),e.jsxs(te,{children:[e.jsx(D,{onClick:()=>W(!1),color:"primary",children:"Cancel"}),e.jsx(D,{onClick:U,color:"secondary",autoFocus:!0,children:n.reset})]})]}),e.jsxs(X,{open:R,onClose:P,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ee,{id:"alert-dialog-title",children:n.emptyTextError}),e.jsx(te,{children:e.jsx(D,{onClick:P,color:"primary",autoFocus:!0,children:"OK"})})]})]})},Q={correctness:{},suggestions:{}},Pe=(o,t,a=[])=>{Q.correctness[o]=t,Q.suggestions[o]=a},$e=o=>Q.suggestions[o]||[],se=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],re=G.import("attributors/style/size");re.whitelist=se;G.register(re,!0);const Fe={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:se}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},oe=[".",",","!","?",";",":"],qe=(o,t)=>{let a=t,i=t;for(;a>0&&!/\s/.test(o[a-1])&&!oe.includes(o[a-1]);)a--;for(;i<o.length&&!/\s/.test(o[i])&&!oe.includes(o[i]);)i++;return o.substring(a,i)},$=(o,t)=>{const a=o.getText(),i=new RegExp(`([^\\w]|^)(${t})([^\\w]|$)`,"g");let r;for(;(r=i.exec(a))!==null;){const n=r.index+r[1].length,T=r[2].length;o.formatText(n,T,{underline:!0})}document.querySelectorAll(".ql-editor u").forEach(n=>{n.innerText.trim()===t&&n.classList.add("red-underline")})},le=document.createElement("style");le.innerHTML=`
  .red-underline {
    text-decoration: underline;
    text-decoration-color: red;  /* Only the underline will be red */
    text-decoration-thickness: 3px;  /* Adjust underline thickness if needed */
  }
`;document.head.appendChild(le);const K=o=>{const t=/[^\w\u0C80-\u0CFF]+/g;return o.replace(t,"")},Me=({clickedWord:o,suggestions:t,tooltipPosition:a,setClickedWord:i,replaceWord:r,addDictionary:g,replaceAll:n,ignoreAll:T})=>{var v;const{language:s}=ne(),m={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},C=m[s]||m.en;return e.jsxs("div",{className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:a.top+100,left:a.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:()=>i(null),"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[" ",((v=t[o])==null?void 0:v.length)>0?t[o].map((S,k)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>r(S),children:S}),k<t[o].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},S)):e.jsx("div",{className:"text-gray-500 text-sm",children:C.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:g,children:C.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:n,children:C.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:T,children:C.ignoreAll})]})]})},jt=()=>{var J;const t=((J=Re().state)==null?void 0:J.uploadedContent)||"",[a,i]=p.useState(""),[r,g]=p.useState([]),[n,T]=p.useState({}),[s,m]=p.useState(null),[C,v]=p.useState({}),[S,k]=p.useState(""),[A,I]=p.useState(!1),[W,R]=p.useState(!1),[H,L]=p.useState(!1),f=p.useRef(null),F=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:z,setWrongWords:q}=ce();p.useEffect(()=>{f.current&&f.current.getEditor().root.setAttribute("spellcheck","false")},[]),p.useEffect(()=>{t&&i(t)},[t]),p.useEffect(()=>{console.log("Wrong Words Updated:",z.length),console.log("Errors Updated:",r.length),R(!0);const l=setTimeout(()=>{var d;const c=(d=f.current)==null?void 0:d.getEditor();z.forEach(u=>$(c,u)),R(!1)},2e3);return()=>clearTimeout(l)},[z]),p.useEffect(()=>{var E;const l=(E=f.current)==null?void 0:E.getEditor(),c=()=>{L(!0)},d=()=>{L(!1)},u=async(b,x)=>{if(H&&b&&b.length===0){const j=l.getText(),h=K(qe(j,b.index));if(h)if(r.includes(h)||z.includes(h)){let N=$e(h);if(N.length===0)try{N=await De(h),Pe(h,!1,N)}catch(B){console.error("Error fetching suggestions:",B)}m(h),T(B=>({...B,[h]:N}));const V=l.getBounds(b.index);v({top:V.bottom+90,left:V.left})}else m(null)}};return document.addEventListener("mousedown",c),document.addEventListener("mouseup",d),l.on("selection-change",u),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("mouseup",d),l.off("selection-change",u)}},[r,H]);const M=l=>{i(l)},O=async l=>{l.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{var u;const c=f.current.getEditor(),d=c.getSelection();if(d){const b=c.getText(0,d.index).trim().split(/\s+/);let x=b[b.length-1].split("").filter(j=>!F.includes(j)).join("");if(r.includes(K(x)))$(c,x);else if(x&&!/^[a-zA-Z0-9]+$/.test(x)&&!(await Ne(x)).status){g(N=>[...N,x]);const h=(u=f.current)==null?void 0:u.getEditor();$(h,x)}}},300))},U=l=>{const c=f.current.getEditor(),d=c.getText(),u=s.length,E=new RegExp(`(\\W|^)(${s})(\\W|$)`,"g");let b;const x=[];for(;(b=E.exec(d))!==null;){const j=b.index+b[1].length,h=u;x.push({startIndex:j,length:h})}for(let j=x.length-1;j>=0;j--){const{startIndex:h,length:N}=x[j];c.deleteText(h,N),c.insertText(h,l)}g(r.filter(j=>j!==s)),m(null)},P=async()=>{if(s)try{const l=await Ae(K(s));if(l){const c=f.current.getEditor(),d=c.getText();let u=d.indexOf(s);if(u!==-1)for(;u!==-1;)c.formatText(u,s.length,{underline:!1,color:""}),u=d.indexOf(s,u+s.length);g(r.filter(E=>E!==s)),m(null),console.log(l)}else console.error("Failed to add the word to the dictionary.")}catch(l){console.error("Error adding word to dictionary:",l)}},w=()=>{s&&I(!0)},y=()=>{const l=f.current.getEditor(),c=l.getText(),d=s.length,u=new RegExp(`(\\W|^)(${s})(\\W|$)`,"g");let E;const b=[];for(;(E=u.exec(c))!==null;){const x=E.index+E[1].length;b.push({startIndex:x,word:S,clickedWordLength:d})}b.reverse().forEach(({startIndex:x,word:j,clickedWordLength:h})=>{l.deleteText(x,h),l.insertText(x,j)}),I(!1),m(null),k("")},Y=()=>{var u;const l=(u=f.current)==null?void 0:u.getEditor(),c=l.getText();let d=c.indexOf(s);if(d!==-1)for(;d!==-1;)l.formatText(d,s.length,{underline:!1,color:""}),d=c.indexOf(s,d+s.length);m(null),g(r.filter(E=>E!==s))},Z=async()=>{var d;console.log("Refresh called"),R(!0);const l=(d=f.current)==null?void 0:d.getEditor();g([]);const c=await We(l);c&&(q(c),c.forEach(u=>$(l,u)),g(c)),R(!1)},ae=l=>{l.target.focus()};return e.jsxs("div",{className:"flex justify-center min-h-screen bg-gray-500 p-3",children:[e.jsxs("div",{className:"w-full max-w-full bg-white rounded-lg shadow-md p-4",children:[" ",e.jsx(He,{text:a,quillRef:f,handleRefresh:Z}),e.jsx(ie,{ref:f,value:a,onChange:M,onKeyDown:O,modules:Fe,className:"",style:{height:"500px",minHeight:"400px",width:"100%"}}),A&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4 rounded shadow-lg w-11/12 max-w-sm mx-auto",children:[" ",e.jsxs("h5",{className:"mb-2",children:["Replace ",s," with:"]}),e.jsx("input",{type:"text",autoFocus:!0,value:S,onChange:l=>k(l.target.value),onClick:ae,className:"border border-gray-300 p-2 rounded w-full",placeholder:"Replacement word"}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{onClick:y,className:"bg-blue-500 text-white px-4 py-2 rounded mr-2",children:"Replace All"}),e.jsx("button",{onClick:()=>I(!1),className:"bg-gray-300 px-4 py-2 rounded",children:"Cancel"})]})]})}),s&&n[s]&&e.jsx(Me,{clickedWord:s,suggestions:n,tooltipPosition:C,setClickedWord:m,replaceWord:U,addDictionary:P,replaceAll:w,ignoreAll:Y})]}),W&&e.jsx(de,{})]})};export{jt as default};
