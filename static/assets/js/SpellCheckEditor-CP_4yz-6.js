import{a as p,j as e}from"./react-DbtEuUu-.js";import{i as pe}from"./react-quill-new-CsnRHLRG.js";import{u as se,L as le,a as xe}from"./index-DhImD5gM.js";import{a as L,R as me,F as he,h as fe,i as _,j as we,k as be,I as ye,b as ve,l as J,m as V,n as ee,o as te,p as oe}from"./@mui-Q8RKV1MB.js";import{F as ae}from"./file-saver-MsKmXMwP.js";import{E as je}from"./jspdf-DEnQ8Zhn.js";import Te from"./html2canvas-DXEQVQnt.js";import{P as ne,T as G,F as Ee,a as Ce}from"./docx-CTs-IowK.js";import{g as Se,r as ke,i as Ne,a as De,c as Ae,b as We}from"./spellcheckApiService-DVJXPW-T.js";import{Q as ie}from"./quill-BbMqpGUw.js";import{b as Re}from"./react-router-ChRMN3_C.js";import"./lodash-es-CCWjDIKd.js";import"./react-dom-DcXkIZDy.js";import"./scheduler-CWG1rEj-.js";import"./react-router-dom-Cm8LtOuy.js";import"./@remix-run-sy-dwM7X.js";import"./axios-C0Zqfgkc.js";import"./@babel-BUfJX6lK.js";import"./fflate-B2WnmEVw.js";import"./fast-png-RHEe-ix0.js";import"./iobuffer-BmLRrqXH.js";import"./pako-n3Pgozwg.js";import"./clsx-B-dksMZM.js";import"./prop-types-Bw6xMO8O.js";import"./reselect-HBGHfvfV.js";import"./react-is-Rj29YxKv.js";import"./@emotion-CK8GFU5m.js";import"./hoist-non-react-statics-BTNdDy0I.js";import"./stylis-YG1R7XFf.js";import"./@popperjs-DC5wud4b.js";import"./react-transition-group-DV1q_uKQ.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-BqocVgKs.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-HWw_HLjB.js";import"./lodash.isequal-H8CToeRs.js";import"./eventemitter3-LhCj3FB1.js";const Q=o=>{const t=new Date,s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${s}${a}${r}-${c}${l}.${o}`},Le=o=>{if(!o)return;const t=document.createElement("div");t.innerHTML=o;const s=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),a=new Blob([s],{type:"text/plain;charset=utf-8"});ae.saveAs(a,Q("txt"))},Me=o=>{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const s=[],a=r=>{if(r.nodeType===Node.TEXT_NODE)r.textContent.trim()&&s.push(new G({text:r.textContent}));else if(r.nodeType===Node.ELEMENT_NODE){const c={};(r.tagName==="B"||r.tagName==="STRONG")&&(c.bold=!0),(r.tagName==="I"||r.tagName==="EM")&&(c.italics=!0),r.tagName==="U"&&(c.underline={}),r.childNodes.length&&r.childNodes.forEach(l=>{l.nodeType===Node.TEXT_NODE?l.textContent.trim()&&s.push(new G({...c,text:l.textContent})):a(l)})}};return t.childNodes.forEach(a),s},Ie=async o=>{if(!o){console.error("No content provided for Word download.");return}try{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const s=[];t.childNodes.forEach(c=>{let l="";c.tagName==="BR"?s.push(new ne({children:[new G({text:""})]})):s.push(new ne({children:Me(c.outerHTML||c.textContent)}))});const a=new Ee({sections:[{properties:{},children:s}]}),r=await Ce.toBlob(a);ae.saveAs(r,Q("docx"))}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},ze=async o=>{try{if(!o)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const s=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=s,document.body.appendChild(t),setTimeout(async()=>{const a=await Te(t,{scale:2}),r=new je,c=a.toDataURL("image/png"),l=r.internal.pageSize.getWidth(),E=r.internal.pageSize.getHeight(),n=10,h=l-2*n,v=a.height*h/a.width;if(v>E-2*n){const C=E-2*n,y=a.width*C/a.height;r.addImage(c,"PNG",n,n,y,C)}else r.addImage(c,"PNG",n,n,h,v);r.save(Q("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},$e=({text:o,quillRef:t,handleRefresh:s,handleReset:a})=>{const{language:r}=se(),c={en:{process:"Process",download:"Download",downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",reset:"Reset",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{process:"ಪ್ರಕ್ರಿಯೆ",download:"ಡೌನ್‌ಲೋಡ್",downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",reset:"ಮರುಹೊಂದಿಸಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},l=c[r]||c.en,[E,n]=p.useState(!1),[h,v]=p.useState({open:!1,message:"",type:""}),[C,y]=p.useState(!1),[W,R]=p.useState(!1),[j,k]=p.useState(null),N=async(S,B)=>{if(!o||o.trim()===""||o==="<p><br></p>"){R(!0);return}n(!0);try{await B(),v({open:!0,message:l.downloadSuccess.replace("{type}",S),type:"success"})}catch{v({open:!0,message:l.downloadError.replace("{type}",S),type:"error"})}n(!1)},M=()=>v({...h,open:!1}),I=S=>{k(S.currentTarget)},w=()=>{k(null)},F=()=>{N(".txt",()=>Le(o)),w()},D=()=>{N(".docx",()=>Ie(o)),w()},A=()=>{N(".pdf",()=>ze(o)),w()},H=()=>{const S=t.current?.getEditor();S&&S.setText(""),y(!1)},O=()=>{y(!0)},q=()=>{H()},z=()=>{R(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center w-full pl-0 pr-8 sm:pr-12 justify-start gap-0",children:[e.jsxs(L,{variant:"contained",onClick:s,className:"!flex !items-center !space-x-1.5 min-w-0 ml-4 sm:ml-6",sx:{padding:"8px 12px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #10b981, #059669)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(me,{fontSize:"small"}),e.jsx("span",{children:l.process})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(L,{variant:"contained",onClick:I,className:"!flex !items-center !space-x-1.5 mr-2",sx:{padding:"8px 16px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #1d4ed8, #1e40af)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:l.download})]}),e.jsxs(fe,{anchorEl:j,open:!!j,onClose:w,PaperProps:{sx:{mt:1,minWidth:180}},children:[e.jsx(_,{onClick:F,sx:{py:1.5},children:l.downloadTxt}),e.jsx(_,{onClick:D,sx:{py:1.5},children:l.downloadDocx}),e.jsx(_,{onClick:A,sx:{py:1.5},children:l.downloadPdf})]}),e.jsxs(L,{variant:"contained",onClick:O,className:"!flex !items-center !space-x-1.5 mr-4 sm:mr-6",sx:{padding:"8px 12px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #ef4444, #dc2626)",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.3)","&:hover":{background:"linear-gradient(135deg, #dc2626, #b91c1c)",boxShadow:"0 6px 20px rgba(239, 68, 68, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(we,{fontSize:"small"}),e.jsx("span",{children:l.reset})]})]}),e.jsx(be,{open:h.open,autoHideDuration:4e3,onClose:M,message:h.message,action:e.jsx(ye,{size:"small","aria-label":"close",color:"inherit",onClick:M,children:e.jsx(ve,{fontSize:"small"})}),severity:h.type,sx:{"& .MuiSnackbarContent-root":{backgroundColor:h.type==="success"?"#10b981":"#ef4444"}}}),e.jsxs(J,{open:C,onClose:()=>y(!1),children:[e.jsx(V,{children:l.reset}),e.jsx(ee,{children:e.jsx(te,{children:l.resetConfirmation})}),e.jsxs(oe,{children:[e.jsx(L,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(L,{onClick:q,variant:"contained",color:"error",children:"Confirm"})]})]}),e.jsxs(J,{open:W,onClose:z,children:[e.jsx(V,{children:"Error"}),e.jsx(ee,{children:e.jsx(te,{children:l.emptyTextError})}),e.jsx(oe,{children:e.jsx(L,{onClick:z,children:"Close"})})]}),E&&e.jsx(le,{})]})})},K={correctness:{},suggestions:{}},Pe=(o,t,s=[])=>{K.correctness[o]=t,K.suggestions[o]=s},Fe=o=>K.suggestions[o]||[],ce=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],de=ie.import("attributors/style/size");de.whitelist=ce;ie.register(de,!0);const He={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:ce}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},re=[".",",","!","?",";",":"],Oe=(o,t)=>{let s=t,a=t;for(;s>0&&!/\s/.test(o[s-1])&&!re.includes(o[s-1]);)s--;for(;a<o.length&&!/\s/.test(o[a])&&!re.includes(o[a]);)a++;return o.substring(s,a)},P=(o,t)=>{const s=o.getText(),a=new RegExp(`([^\\w]|^)(${t})([^\\w]|$)`,"g");let r;for(;(r=a.exec(s))!==null;){const l=r.index+r[1].length,E=r[2].length;o.formatText(l,E,{underline:!0})}document.querySelectorAll(".ql-editor u").forEach(l=>{l.innerText.trim()===t&&l.classList.add("red-underline")})},ue=document.createElement("style");ue.innerHTML=`
  .red-underline {
    text-decoration: underline;
    text-decoration-color: red;  /* Only the underline will be red */
    text-decoration-thickness: 3px;  /* Adjust underline thickness if needed */
  }
`;document.head.appendChild(ue);const Y=o=>{const t=/[^\w\u0C80-\u0CFF]+/g;return o.replace(t,"")},qe=({clickedWord:o,suggestions:t,tooltipPosition:s,setClickedWord:a,replaceWord:r,addDictionary:c,replaceAll:l,ignoreAll:E})=>{const{language:n}=se(),h={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},v=h[n]||h.en,C=p.useRef(null),y=p.useRef(!1);p.useEffect(()=>{const j=k=>{C.current&&!C.current.contains(k.target)&&(y.current||a(null))};return document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}},[a]);const W=()=>{y.current=!0,l()},R=()=>{a(null)};return e.jsxs("div",{ref:C,className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:s.top+100,left:s.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:R,"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[t[o]?.length>0?t[o].map((j,k)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>r(j),children:j}),k<t[o].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},j)):e.jsx("div",{className:"text-gray-500 text-sm",children:v.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:c,children:v.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:W,children:v.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:E,children:v.ignoreAll})]})]})},St=()=>{const t=Re().state?.uploadedContent||"",[s,a]=p.useState(""),[r,c]=p.useState([]),[l,E]=p.useState({}),[n,h]=p.useState(null),[v,C]=p.useState({}),[y,W]=p.useState(""),[R,j]=p.useState(!1),[k,N]=p.useState(!1),[M,I]=p.useState(!1),w=p.useRef(null),F=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:D,setWrongWords:A}=xe();p.useEffect(()=>{w.current&&w.current.getEditor().root.setAttribute("spellcheck","false")},[]),p.useEffect(()=>{if(t.length==0){A([]);return}if(t&&(console.log("updating content into editor ...."),a(t)),!D||D.length===0)return;c([]),console.log("Wrong Words Updated:",D.length),console.log("Errors Updated:",r.length),N(!0);const i=setTimeout(()=>{const u=w.current?.getEditor();console.log("Underlining the wrong words"),D.forEach(d=>P(u,d)),N(!1)},3e3);return()=>clearTimeout(i)},[t]),p.useEffect(()=>{const i=w.current?.getEditor(),u=()=>{I(!0)},d=()=>{I(!1)},b=async(x,m)=>{if(M&&x&&x.length===0){const f=i.getText(),g=Y(Oe(f,x.index));if(g)if(r.includes(g)||D.includes(g)){let T=Fe(g);if(T.length===0)try{T=await Se(g),Pe(g,!1,T)}catch(U){console.error("Error fetching suggestions:",U)}h(g),E(U=>({...U,[g]:T}));const $=i.getBounds(x.index);C({top:$.bottom+90,left:$.left})}else h(null)}};return document.addEventListener("mousedown",u),document.addEventListener("mouseup",d),i.on("selection-change",b),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("mouseup",d),i.off("selection-change",b)}},[r,M]);const H=i=>{a(i)},O=async i=>{i.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{const u=w.current.getEditor(),d=u.getSelection();if(d){const x=u.getText(0,d.index).trim().split(/\s+/);let m=x[x.length-1].split("").filter(f=>!F.includes(f)).join("");if(De(m))return;if(r.includes(Y(m)))P(u,m);else if(m&&!/^[a-zA-Z0-9]+$/.test(m)&&!(await Ae(m)).status){c(T=>[...T,m]);const g=w.current?.getEditor();P(g,m)}}},300))},q=i=>{const u=w.current.getEditor(),d=u.getText(),b=n.length,x=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let m;const f=[];for(;(m=x.exec(d))!==null;){const g=m.index+m[1].length,T=b;f.push({startIndex:g,length:T})}for(let g=f.length-1;g>=0;g--){const{startIndex:T,length:$}=f[g];u.deleteText(T,$),u.insertText(T,i)}c(r.filter(g=>g!==n)),h(null)},z=async()=>{if(n)try{const i=Y(n),u=await We([i]);if(u){const d=w.current?.getEditor();if(!d)return;const b=d.getText();let x=b.indexOf(n);for(;x!==-1;)d.formatText(x,n.length,{underline:!1,color:""}),x=b.indexOf(n,x+n.length);A(m=>m.filter(f=>f!==n)),c(m=>m.filter(f=>f!==n)),h(null),console.log("Word added to dictionary:",u)}else console.error("Failed to add the word to the dictionary.")}catch(i){console.error("Error adding word to dictionary:",i)}},S=()=>{n&&j(!0)},B=()=>{const i=w.current.getEditor(),u=i.getText(),d=n.length,b=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let x;const m=[];for(;(x=b.exec(u))!==null;){const f=x.index+x[1].length;m.push({startIndex:f,word:y,clickedWordLength:d})}m.reverse().forEach(({startIndex:f,word:g,clickedWordLength:T})=>{i.deleteText(f,T),i.insertText(f,g)}),A(f=>f.filter(g=>g!==n)),j(!1),h(null),W("")},X=()=>{const i=w.current?.getEditor(),u=i.getText();let d=u.indexOf(n);if(d!==-1)for(;d!==-1;)i.formatText(d,n.length,{underline:!1,color:""}),d=u.indexOf(n,d+n.length);h(null),c(r.filter(b=>b!==n)),A(b=>b.filter(x=>x!==n))},Z=async()=>{console.log("Refresh called"),N(!0);const i=w.current?.getEditor();c([]);const u=await ke(i);if(u){const d=Ne(u);A(d),d.forEach(b=>P(i,b)),c(d)}N(!1)},ge=i=>{i.target.focus()};return e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col w-full max-w-[98vw] xl:max-w-8xl mx-auto p-0 sm:p-1 gap-0.5 sm:gap-1.5 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 pt-1 sm:pt-1.5",children:e.jsx("div",{className:"w-full max-w-5xl mx-auto flex justify-between items-center py-1 gap-3 sm:gap-6",children:e.jsx($e,{text:s,quillRef:w,handleRefresh:Z})})}),e.jsx("div",{className:"flex-1 min-h-0 bg-white rounded-2xl shadow-2xl border border-gray-200/50 overflow-hidden mx-0.5 sm:mx-0 -mt-2",children:e.jsx(pe,{ref:w,value:s,onChange:H,onKeyDown:O,modules:He,className:"h-full w-full",style:{height:"100%",width:"100%",maxWidth:"100%",minHeight:"0"},theme:"snow"})}),R&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200/50 p-6 rounded-2xl shadow-2xl w-full max-w-lg mx-4",children:[e.jsxs("h5",{className:"mb-5 font-bold text-xl text-gray-800",children:["Replace all ",e.jsxs("span",{className:"text-red-500",children:['"',n,'"']}),e.jsxs("span",{className:"text-sm font-normal text-gray-500 block mt-1",children:["(",s.split(new RegExp(n,"gi")).length-1," occurrences)"]})]}),e.jsx("input",{type:"text",autoFocus:!0,value:y,onChange:i=>W(i.target.value),onClick:ge,className:"w-full border-2 border-gray-200 p-4 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all duration-200 text-lg placeholder-gray-400",placeholder:"Type replacement word here..."}),e.jsxs("div",{className:"flex gap-3 justify-end mt-6",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-all duration-200 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:!y.trim(),className:`px-8 py-3 rounded-xl font-semibold text-lg shadow-lg transition-all duration-200 transform ${y.trim()?"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white hover:shadow-xl hover:-translate-y-0.5 active:scale-95":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Replace All"})]})]})}),n&&l[n]&&e.jsx(qe,{clickedWord:n,suggestions:l,tooltipPosition:v,setClickedWord:h,replaceWord:q,addDictionary:z,replaceAll:S,ignoreAll:X})]}),k&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-40 bg-black/20 backdrop-blur-sm",children:e.jsx(le,{})})]})};export{St as default};
