import{a as p,j as e}from"./react-DbtEuUu-.js";import{i as pe}from"./react-quill-new-CsnRHLRG.js";import{u as re,L as le,a as me}from"./index-CKbVKAJQ.js";import{a as L,R as he,F as xe,h as fe,i as _,j as we,k as ye,I as be,b as Te,l as J,m as V,n as ee,o as te,p as oe}from"./@mui-Q8RKV1MB.js";import{F as ae}from"./file-saver-MsKmXMwP.js";import{E as Ee}from"./jspdf-DEnQ8Zhn.js";import je from"./html2canvas-DXEQVQnt.js";import{P as ne,T as K,F as Ce,a as ve}from"./docx-CTs-IowK.js";import{g as Se,r as De,i as Ne,a as ke,c as Ae,b as Re}from"./spellcheckApiService-C3D-mHAo.js";import{Q as ie}from"./quill-BbMqpGUw.js";import{b as We}from"./react-router-ChRMN3_C.js";import"./lodash-es-CCWjDIKd.js";import"./react-dom-DcXkIZDy.js";import"./scheduler-CWG1rEj-.js";import"./react-router-dom-Cm8LtOuy.js";import"./@remix-run-sy-dwM7X.js";import"./axios-C0Zqfgkc.js";import"./@babel-BUfJX6lK.js";import"./fflate-B2WnmEVw.js";import"./fast-png-RHEe-ix0.js";import"./iobuffer-BmLRrqXH.js";import"./pako-n3Pgozwg.js";import"./clsx-B-dksMZM.js";import"./prop-types-Bw6xMO8O.js";import"./reselect-HBGHfvfV.js";import"./react-is-Rj29YxKv.js";import"./@emotion-CK8GFU5m.js";import"./hoist-non-react-statics-BTNdDy0I.js";import"./stylis-YG1R7XFf.js";import"./@popperjs-DC5wud4b.js";import"./react-transition-group-DV1q_uKQ.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-BqocVgKs.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-HWw_HLjB.js";import"./lodash.isequal-H8CToeRs.js";import"./eventemitter3-LhCj3FB1.js";const X=o=>{const t=new Date,l=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${l}${a}${s}-${c}${r}.${o}`},Le=o=>{if(!o)return;const t=document.createElement("div");t.innerHTML=o;const l=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),a=new Blob([l],{type:"text/plain;charset=utf-8"});ae.saveAs(a,X("txt"))},Me=o=>{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const l=[],a=s=>{if(s.nodeType===Node.TEXT_NODE)s.textContent.trim()&&l.push(new K({text:s.textContent}));else if(s.nodeType===Node.ELEMENT_NODE){const c={};(s.tagName==="B"||s.tagName==="STRONG")&&(c.bold=!0),(s.tagName==="I"||s.tagName==="EM")&&(c.italics=!0),s.tagName==="U"&&(c.underline={}),s.childNodes.length&&s.childNodes.forEach(r=>{r.nodeType===Node.TEXT_NODE?r.textContent.trim()&&l.push(new K({...c,text:r.textContent})):a(r)})}};return t.childNodes.forEach(a),l},Ie=async o=>{if(!o){console.error("No content provided for Word download.");return}try{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const l=[];t.childNodes.forEach(c=>{let r="";c.tagName==="BR"?l.push(new ne({children:[new K({text:""})]})):l.push(new ne({children:Me(c.outerHTML||c.textContent)}))});const a=new Ce({sections:[{properties:{},children:l}]}),s=await ve.toBlob(a);ae.saveAs(s,X("docx"))}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},$e=async o=>{try{if(!o)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const l=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=l,document.body.appendChild(t),setTimeout(async()=>{const a=await je(t,{scale:2}),s=new Ee,c=a.toDataURL("image/png"),r=s.internal.pageSize.getWidth(),C=s.internal.pageSize.getHeight(),n=10,f=r-2*n,T=a.height*f/a.width;if(T>C-2*n){const v=C-2*n,b=a.width*v/a.height;s.addImage(c,"PNG",n,n,b,v)}else s.addImage(c,"PNG",n,n,f,T);s.save(X("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},ze=({text:o,quillRef:t,handleRefresh:l,handleReset:a})=>{const{language:s}=re(),c={en:{process:"Process",download:"Download",downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",reset:"Reset",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{process:"ಪ್ರಕ್ರಿಯೆ",download:"ಡೌನ್‌ಲೋಡ್",downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",reset:"ಮರುಹೊಂದಿಸಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},r=c[s]||c.en,[C,n]=p.useState(!1),[f,T]=p.useState({open:!1,message:"",type:""}),[v,b]=p.useState(!1),[R,W]=p.useState(!1),[E,D]=p.useState(null),N=async(S,B)=>{if(!o||o.trim()===""||o==="<p><br></p>"){W(!0);return}n(!0);try{await B(),T({open:!0,message:r.downloadSuccess.replace("{type}",S),type:"success"})}catch{T({open:!0,message:r.downloadError.replace("{type}",S),type:"error"})}n(!1)},M=()=>T({...f,open:!1}),I=S=>{D(S.currentTarget)},w=()=>{D(null)},H=()=>{N(".txt",()=>Le(o)),w()},k=()=>{N(".docx",()=>Ie(o)),w()},A=()=>{N(".pdf",()=>$e(o)),w()},O=()=>{const S=t.current?.getEditor();S&&S.setText(""),b(!1)},P=()=>{b(!0)},q=()=>{O()},$=()=>{W(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs(L,{variant:"contained",title:r.process,onClick:l,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem",backgroundColor:"green"},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:r.process})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(L,{variant:"contained",title:r.download,onClick:I,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(xe,{fontSize:"small"}),e.jsx("span",{children:r.download})]}),e.jsxs(fe,{anchorEl:E,open:!!E,onClose:w,children:[e.jsx(_,{onClick:H,children:r.downloadTxt}),e.jsx(_,{onClick:k,children:r.downloadDocx}),e.jsx(_,{onClick:A,children:r.downloadPdf})]}),e.jsxs(L,{variant:"contained",title:r.reset,onClick:P,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem",backgroundColor:"red"},children:[e.jsx(we,{fontSize:"small"}),e.jsx("span",{children:r.reset})]})]}),e.jsx(ye,{open:f.open,autoHideDuration:3e3,onClose:M,message:f.message,action:e.jsx(be,{size:"small","aria-label":"close",color:"inherit",onClick:M,children:e.jsx(Te,{fontSize:"small"})}),severity:f.type}),e.jsxs(J,{open:v,onClose:()=>b(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{id:"alert-dialog-title",children:r.reset}),e.jsx(ee,{children:e.jsx(te,{id:"alert-dialog-description",children:r.resetConfirmation})}),e.jsxs(oe,{children:[e.jsx(L,{onClick:()=>b(!1),color:"primary",children:"Cancel"}),e.jsx(L,{onClick:q,color:"primary",autoFocus:!0,children:"Confirm"})]})]}),e.jsxs(J,{open:R,onClose:$,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{id:"alert-dialog-title",children:"Error"}),e.jsx(ee,{children:e.jsx(te,{id:"alert-dialog-description",children:r.emptyTextError})}),e.jsx(oe,{children:e.jsx(L,{onClick:$,color:"primary",children:"Close"})})]}),C&&e.jsx(le,{})]})})},Q={correctness:{},suggestions:{}},Fe=(o,t,l=[])=>{Q.correctness[o]=t,Q.suggestions[o]=l},He=o=>Q.suggestions[o]||[],ce=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],de=ie.import("attributors/style/size");de.whitelist=ce;ie.register(de,!0);const Oe={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:ce}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},se=[".",",","!","?",";",":"],Pe=(o,t)=>{let l=t,a=t;for(;l>0&&!/\s/.test(o[l-1])&&!se.includes(o[l-1]);)l--;for(;a<o.length&&!/\s/.test(o[a])&&!se.includes(o[a]);)a++;return o.substring(l,a)},F=(o,t)=>{const l=o.getText(),a=new RegExp(`([^\\w]|^)(${t})([^\\w]|$)`,"g");let s;for(;(s=a.exec(l))!==null;){const r=s.index+s[1].length,C=s[2].length;o.formatText(r,C,{underline:!0})}document.querySelectorAll(".ql-editor u").forEach(r=>{r.innerText.trim()===t&&r.classList.add("red-underline")})},ue=document.createElement("style");ue.innerHTML=`
  .red-underline {
    text-decoration: underline;
    text-decoration-color: red;  /* Only the underline will be red */
    text-decoration-thickness: 3px;  /* Adjust underline thickness if needed */
  }
`;document.head.appendChild(ue);const G=o=>{const t=/[^\w\u0C80-\u0CFF]+/g;return o.replace(t,"")},qe=({clickedWord:o,suggestions:t,tooltipPosition:l,setClickedWord:a,replaceWord:s,addDictionary:c,replaceAll:r,ignoreAll:C})=>{const{language:n}=re(),f={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},T=f[n]||f.en,v=p.useRef(null),b=p.useRef(!1);p.useEffect(()=>{const E=D=>{v.current&&!v.current.contains(D.target)&&(b.current||a(null))};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[a]);const R=()=>{b.current=!0,r()},W=()=>{a(null)};return e.jsxs("div",{ref:v,className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:l.top+100,left:l.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:W,"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[t[o]?.length>0?t[o].map((E,D)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>s(E),children:E}),D<t[o].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},E)):e.jsx("div",{className:"text-gray-500 text-sm",children:T.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:c,children:T.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:R,children:T.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:C,children:T.ignoreAll})]})]})},St=()=>{const t=We().state?.uploadedContent||"",[l,a]=p.useState(""),[s,c]=p.useState([]),[r,C]=p.useState({}),[n,f]=p.useState(null),[T,v]=p.useState({}),[b,R]=p.useState(""),[W,E]=p.useState(!1),[D,N]=p.useState(!1),[M,I]=p.useState(!1),w=p.useRef(null),H=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:k,setWrongWords:A}=me();p.useEffect(()=>{w.current&&w.current.getEditor().root.setAttribute("spellcheck","false")},[]),p.useEffect(()=>{if(t.length==0){A([]);return}if(t&&(console.log("updating content into editor ...."),a(t)),!k||k.length===0)return;c([]),console.log("Wrong Words Updated:",k.length),console.log("Errors Updated:",s.length),N(!0);const i=setTimeout(()=>{const u=w.current?.getEditor();console.log("Underlining the wrong words"),k.forEach(d=>F(u,d)),N(!1)},3e3);return()=>clearTimeout(i)},[t]),p.useEffect(()=>{const i=w.current?.getEditor(),u=()=>{I(!0)},d=()=>{I(!1)},y=async(m,h)=>{if(M&&m&&m.length===0){const x=i.getText(),g=G(Pe(x,m.index));if(g)if(s.includes(g)||k.includes(g)){let j=He(g);if(j.length===0)try{j=await Se(g),Fe(g,!1,j)}catch(U){console.error("Error fetching suggestions:",U)}f(g),C(U=>({...U,[g]:j}));const z=i.getBounds(m.index);v({top:z.bottom+90,left:z.left})}else f(null)}};return document.addEventListener("mousedown",u),document.addEventListener("mouseup",d),i.on("selection-change",y),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("mouseup",d),i.off("selection-change",y)}},[s,M]);const O=i=>{a(i)},P=async i=>{i.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{const u=w.current.getEditor(),d=u.getSelection();if(d){const m=u.getText(0,d.index).trim().split(/\s+/);let h=m[m.length-1].split("").filter(x=>!H.includes(x)).join("");if(ke(h))return;if(s.includes(G(h)))F(u,h);else if(h&&!/^[a-zA-Z0-9]+$/.test(h)&&!(await Ae(h)).status){c(j=>[...j,h]);const g=w.current?.getEditor();F(g,h)}}},300))},q=i=>{const u=w.current.getEditor(),d=u.getText(),y=n.length,m=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let h;const x=[];for(;(h=m.exec(d))!==null;){const g=h.index+h[1].length,j=y;x.push({startIndex:g,length:j})}for(let g=x.length-1;g>=0;g--){const{startIndex:j,length:z}=x[g];u.deleteText(j,z),u.insertText(j,i)}c(s.filter(g=>g!==n)),f(null)},$=async()=>{if(n)try{const i=G(n),u=await Re([i]);if(u){const d=w.current?.getEditor();if(!d)return;const y=d.getText();let m=y.indexOf(n);for(;m!==-1;)d.formatText(m,n.length,{underline:!1,color:""}),m=y.indexOf(n,m+n.length);A(h=>h.filter(x=>x!==n)),c(h=>h.filter(x=>x!==n)),f(null),console.log("Word added to dictionary:",u)}else console.error("Failed to add the word to the dictionary.")}catch(i){console.error("Error adding word to dictionary:",i)}},S=()=>{n&&E(!0)},B=()=>{const i=w.current.getEditor(),u=i.getText(),d=n.length,y=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let m;const h=[];for(;(m=y.exec(u))!==null;){const x=m.index+m[1].length;h.push({startIndex:x,word:b,clickedWordLength:d})}h.reverse().forEach(({startIndex:x,word:g,clickedWordLength:j})=>{i.deleteText(x,j),i.insertText(x,g)}),A(x=>x.filter(g=>g!==n)),E(!1),f(null),R("")},Y=()=>{const i=w.current?.getEditor(),u=i.getText();let d=u.indexOf(n);if(d!==-1)for(;d!==-1;)i.formatText(d,n.length,{underline:!1,color:""}),d=u.indexOf(n,d+n.length);f(null),c(s.filter(y=>y!==n)),A(y=>y.filter(m=>m!==n))},Z=async()=>{console.log("Refresh called"),N(!0);const i=w.current?.getEditor();c([]);const u=await De(i);if(u){const d=Ne(u);A(d),d.forEach(y=>F(i,y)),c(d)}N(!1)},ge=i=>{i.target.focus()};return e.jsxs("div",{className:"flex justify-center min-h-screen bg-gray-500 p-3",children:[e.jsxs("div",{className:"w-full max-w-full bg-white rounded-lg shadow-md p-4",children:[" ",e.jsx(ze,{text:l,quillRef:w,handleRefresh:Z}),e.jsx(pe,{ref:w,value:l,onChange:O,onKeyDown:P,modules:Oe,className:"",style:{height:"500px",minHeight:"400px",width:"100%"}}),W&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4 rounded shadow-lg w-11/12 max-w-sm mx-auto",children:[e.jsxs("h5",{className:"mb-2",children:["Replace ",n," with:"]}),e.jsx("input",{type:"text",autoFocus:!0,value:b,onChange:i=>R(i.target.value),onClick:ge,className:"border border-gray-300 p-2 rounded w-full",placeholder:"Replacement word"}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{onClick:B,className:`bg-blue-500 text-white px-4 py-2 rounded mr-2 ${b.trim()?"":"opacity-50 cursor-not-allowed"}`,disabled:!b.trim(),children:"Replace All"}),e.jsx("button",{onClick:()=>E(!1),className:"bg-gray-300 px-4 py-2 rounded",children:"Cancel"})]})]})}),n&&r[n]&&e.jsx(qe,{clickedWord:n,suggestions:r,tooltipPosition:T,setClickedWord:f,replaceWord:q,addDictionary:$,replaceAll:S,ignoreAll:Y})]}),D&&e.jsx(le,{})]})};export{St as default};
