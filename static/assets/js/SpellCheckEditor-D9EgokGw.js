import{a as p,j as e}from"./react-DbtEuUu-.js";import{i as pe}from"./react-quill-new-CsnRHLRG.js";import{u as se,L as le,a as xe}from"./index-4PW5uvRb.js";import{a as L,R as me,F as he,h as fe,i as _,j as we,k as be,I as ye,b as ve,l as J,m as V,n as ee,o as te,p as oe}from"./@mui-Q8RKV1MB.js";import{F as ae}from"./file-saver-MsKmXMwP.js";import{E as je}from"./jspdf-DEnQ8Zhn.js";import Te from"./html2canvas-DXEQVQnt.js";import{P as ne,T as G,F as Ee,a as Ce}from"./docx-CTs-IowK.js";import{g as Se,r as ke,i as Ne,a as De,c as Ae,b as We}from"./spellcheckApiService-ekyxb-Gb.js";import{Q as ie}from"./quill-BbMqpGUw.js";import{b as Re}from"./react-router-ChRMN3_C.js";import"./lodash-es-CCWjDIKd.js";import"./react-dom-DcXkIZDy.js";import"./scheduler-CWG1rEj-.js";import"./react-router-dom-Cm8LtOuy.js";import"./@remix-run-sy-dwM7X.js";import"./axios-C0Zqfgkc.js";import"./@babel-BUfJX6lK.js";import"./fflate-B2WnmEVw.js";import"./fast-png-RHEe-ix0.js";import"./iobuffer-BmLRrqXH.js";import"./pako-n3Pgozwg.js";import"./clsx-B-dksMZM.js";import"./prop-types-Bw6xMO8O.js";import"./reselect-HBGHfvfV.js";import"./react-is-Rj29YxKv.js";import"./@emotion-CK8GFU5m.js";import"./hoist-non-react-statics-BTNdDy0I.js";import"./stylis-YG1R7XFf.js";import"./@popperjs-DC5wud4b.js";import"./react-transition-group-DV1q_uKQ.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-BqocVgKs.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-HWw_HLjB.js";import"./lodash.isequal-H8CToeRs.js";import"./eventemitter3-LhCj3FB1.js";const Q=o=>{const t=new Date,r=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear(),a=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${r}${l}${s}-${a}${i}.${o}`},Le=o=>{if(!o)return;const t=document.createElement("div");t.innerHTML=o;const r=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),l=new Blob([r],{type:"text/plain;charset=utf-8"});ae.saveAs(l,Q("txt"))},Fe=o=>{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const r=[],l=s=>{if(s.nodeType===Node.TEXT_NODE)s.textContent.trim()&&r.push(new G({text:s.textContent}));else if(s.nodeType===Node.ELEMENT_NODE){const a={};(s.tagName==="B"||s.tagName==="STRONG")&&(a.bold=!0),(s.tagName==="I"||s.tagName==="EM")&&(a.italics=!0),s.tagName==="U"&&(a.underline={}),s.childNodes.length&&s.childNodes.forEach(i=>{i.nodeType===Node.TEXT_NODE?i.textContent.trim()&&r.push(new G({...a,text:i.textContent})):l(i)})}};return t.childNodes.forEach(l),r},Ie=async o=>{if(!o){console.error("No content provided for Word download.");return}try{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const r=[];t.childNodes.forEach(a=>{let i="";a.tagName==="BR"?r.push(new ne({children:[new G({text:""})]})):r.push(new ne({children:Fe(a.outerHTML||a.textContent)}))});const l=new Ee({sections:[{properties:{},children:r}]}),s=await Ce.toBlob(l);ae.saveAs(s,Q("docx"))}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},Me=async o=>{try{if(!o)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const r=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=r,document.body.appendChild(t),setTimeout(async()=>{const l=await Te(t,{scale:2}),s=new je,a=l.toDataURL("image/png"),i=s.internal.pageSize.getWidth(),y=s.internal.pageSize.getHeight(),n=10,h=i-2*n,j=l.height*h/l.width;if(j>y-2*n){const C=y-2*n,v=l.width*C/l.height;s.addImage(a,"PNG",n,n,v,C)}else s.addImage(a,"PNG",n,n,h,j);s.save(Q("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},$e=({text:o,quillRef:t,handleRefresh:r,handleReset:l})=>{const{language:s}=se(),a={en:{process:"Process",download:"Download",downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",reset:"Reset",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{process:"ಪ್ರಕ್ರಿಯೆ",download:"ಡೌನ್‌ಲೋಡ್",downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",reset:"ಮರುಹೊಂದಿಸಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},i=a[s]||a.en,[y,n]=p.useState(!1),[h,j]=p.useState({open:!1,message:"",type:""}),[C,v]=p.useState(!1),[W,R]=p.useState(!1),[T,k]=p.useState(null),N=async(S,B)=>{if(!o||o.trim()===""||o==="<p><br></p>"){R(!0);return}n(!0);try{await B(),j({open:!0,message:i.downloadSuccess.replace("{type}",S),type:"success"})}catch{j({open:!0,message:i.downloadError.replace("{type}",S),type:"error"})}n(!1)},F=()=>j({...h,open:!1}),I=S=>{k(S.currentTarget)},w=()=>{k(null)},z=()=>{N(".txt",()=>Le(o)),w()},D=()=>{N(".docx",()=>Ie(o)),w()},A=()=>{N(".pdf",()=>Me(o)),w()},P=()=>{const S=t.current?.getEditor();S&&S.setText(""),v(!1)},H=()=>{v(!0)},O=()=>{P()},M=()=>{R(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center w-full pl-0 pr-8 sm:pr-12 justify-start gap-0",children:[e.jsxs(L,{variant:"contained",onClick:r,className:"!flex !items-center !space-x-1.5 min-w-0 ml-4 sm:ml-6",sx:{padding:"8px 12px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #10b981, #059669)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(me,{fontSize:"small"}),e.jsx("span",{children:i.process})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(L,{variant:"contained",onClick:I,className:"!flex !items-center !space-x-1.5 mr-2",sx:{padding:"8px 16px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #1d4ed8, #1e40af)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:i.download})]}),e.jsxs(fe,{anchorEl:T,open:!!T,onClose:w,PaperProps:{sx:{mt:1,minWidth:180}},children:[e.jsx(_,{onClick:z,sx:{py:1.5},children:i.downloadTxt}),e.jsx(_,{onClick:D,sx:{py:1.5},children:i.downloadDocx}),e.jsx(_,{onClick:A,sx:{py:1.5},children:i.downloadPdf})]}),e.jsxs(L,{variant:"contained",onClick:H,className:"!flex !items-center !space-x-1.5 mr-4 sm:mr-6",sx:{padding:"8px 12px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #ef4444, #dc2626)",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.3)","&:hover":{background:"linear-gradient(135deg, #dc2626, #b91c1c)",boxShadow:"0 6px 20px rgba(239, 68, 68, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(we,{fontSize:"small"}),e.jsx("span",{children:i.reset})]})]}),e.jsx(be,{open:h.open,autoHideDuration:4e3,onClose:F,message:h.message,action:e.jsx(ye,{size:"small","aria-label":"close",color:"inherit",onClick:F,children:e.jsx(ve,{fontSize:"small"})}),severity:h.type,sx:{"& .MuiSnackbarContent-root":{backgroundColor:h.type==="success"?"#10b981":"#ef4444"}}}),e.jsxs(J,{open:C,onClose:()=>v(!1),children:[e.jsx(V,{children:i.reset}),e.jsx(ee,{children:e.jsx(te,{children:i.resetConfirmation})}),e.jsxs(oe,{children:[e.jsx(L,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(L,{onClick:O,variant:"contained",color:"error",children:"Confirm"})]})]}),e.jsxs(J,{open:W,onClose:M,children:[e.jsx(V,{children:"Error"}),e.jsx(ee,{children:e.jsx(te,{children:i.emptyTextError})}),e.jsx(oe,{children:e.jsx(L,{onClick:M,children:"Close"})})]}),y&&e.jsx(le,{})]})})},K={correctness:{},suggestions:{}},ze=(o,t,r=[])=>{K.correctness[o]=t,K.suggestions[o]=r},Pe=o=>K.suggestions[o]||[],ce=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],de=ie.import("attributors/style/size");de.whitelist=ce;ie.register(de,!0);const He={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:ce}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},re=[".",",","!","?",";",":",'"',"'","(",")","[","]","{","}"],Oe=(o,t)=>{const r=[],l=Array.from(t);for(let s of l){const a=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`([^\\wಀ-೿]|^)(${a})([^\\wಀ-೿]|$)`,"gi");let y;for(;(y=i.exec(o))!==null;)r.push({index:y.index+y[1].length,length:y[2].length,word:s})}return r},ue=(o,t)=>{if(!t?.length||!o)return;const r=o.getText(),l=new Set(t);Oe(r,l).forEach(({index:a,length:i})=>{try{o.formatText(a,i,{underline:!0,color:"#dc2626","text-decoration-thickness":"3px"})}catch{}})},Be=o=>{if(!o)return;const t=o.getText();try{o.formatText(0,t.length,{underline:!1,color:"inherit","text-decoration-thickness":"initial"})}catch{}},qe=(o,t)=>{let r=t,l=t;for(;r>0&&!/\s/.test(o[r-1])&&!re.includes(o[r-1]);)r--;for(;l<o.length&&!/\s/.test(o[l])&&!re.includes(o[l]);)l++;return o.substring(r,l)},U=o=>{const t=/[^\w\u0C80-\u0CFF]/g;return o.replace(t,"").trim()},Y=(o,t)=>{ue(o,[t])};if(typeof document<"u"){const o=document.querySelector("style[data-red-underline]");o&&o.remove()}const _e=({clickedWord:o,suggestions:t,tooltipPosition:r,setClickedWord:l,replaceWord:s,addDictionary:a,replaceAll:i,ignoreAll:y})=>{const{language:n}=se(),h={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},j=h[n]||h.en,C=p.useRef(null),v=p.useRef(!1);p.useEffect(()=>{const T=k=>{C.current&&!C.current.contains(k.target)&&(v.current||l(null))};return document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[l]);const W=()=>{v.current=!0,i()},R=()=>{l(null)};return e.jsxs("div",{ref:C,className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:r.top+100,left:r.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:R,"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[t[o]?.length>0?t[o].map((T,k)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>s(T),children:T}),k<t[o].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},T)):e.jsx("div",{className:"text-gray-500 text-sm",children:j.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:a,children:j.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:W,children:j.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:y,children:j.ignoreAll})]})]})},Nt=()=>{const t=Re().state?.uploadedContent||"",[r,l]=p.useState(""),[s,a]=p.useState([]),[i,y]=p.useState({}),[n,h]=p.useState(null),[j,C]=p.useState({}),[v,W]=p.useState(""),[R,T]=p.useState(!1),[k,N]=p.useState(!1),[F,I]=p.useState(!1),w=p.useRef(null),z=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:D,setWrongWords:A}=xe();p.useEffect(()=>{w.current&&w.current.getEditor().root.setAttribute("spellcheck","false")},[]),p.useEffect(()=>{if(t&&t.length>0){console.log("Updating content into editor..."),l(t),A([]),a([]);return}if(!D?.length)return;N(!0),a(D);const c=setTimeout(()=>{const d=w.current?.getEditor();d&&(Be(d),ue(d,D)),N(!1)},500);return()=>clearTimeout(c)},[t,D.length]),p.useEffect(()=>{const c=w.current?.getEditor(),d=()=>{I(!0)},u=()=>{I(!1)},b=async(x,m)=>{if(F&&x&&x.length===0){const f=c.getText(),g=U(qe(f,x.index));if(g)if(s.includes(g)||D.includes(g)){let E=Pe(g);if(E.length===0)try{E=await Se(g),ze(g,!1,E)}catch(q){console.error("Error fetching suggestions:",q)}h(g),y(q=>({...q,[g]:E}));const $=c.getBounds(x.index);C({top:$.bottom+90,left:$.left})}else h(null)}};return document.addEventListener("mousedown",d),document.addEventListener("mouseup",u),c.on("selection-change",b),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("mouseup",u),c.off("selection-change",b)}},[s,F]);const P=c=>{l(c)},H=async c=>{c.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{const d=w.current.getEditor(),u=d.getSelection();if(u){const x=d.getText(0,u.index).trim().split(/\s+/);let m=x[x.length-1].split("").filter(f=>!z.includes(f)).join("");if(De(m))return;if(s.includes(U(m)))Y(d,m);else if(m&&!/^[a-zA-Z0-9]+$/.test(m)&&!(await Ae(m)).status){a(E=>[...E,m]);const g=w.current?.getEditor();Y(g,m)}}},300))},O=c=>{const d=w.current.getEditor(),u=d.getText(),b=n.length,x=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let m;const f=[];for(;(m=x.exec(u))!==null;){const g=m.index+m[1].length,E=b;f.push({startIndex:g,length:E})}for(let g=f.length-1;g>=0;g--){const{startIndex:E,length:$}=f[g];d.deleteText(E,$),d.insertText(E,c)}a(s.filter(g=>g!==n)),h(null)},M=async()=>{if(n)try{const c=U(n),d=await We([c]);if(d){const u=w.current?.getEditor();if(!u)return;const b=u.getText();let x=b.indexOf(n);for(;x!==-1;)u.formatText(x,n.length,{underline:!1,color:""}),x=b.indexOf(n,x+n.length);A(m=>m.filter(f=>f!==n)),a(m=>m.filter(f=>f!==n)),h(null),console.log("Word added to dictionary:",d)}else console.error("Failed to add the word to the dictionary.")}catch(c){console.error("Error adding word to dictionary:",c)}},S=()=>{n&&T(!0)},B=()=>{const c=w.current.getEditor(),d=c.getText(),u=n.length,b=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let x;const m=[];for(;(x=b.exec(d))!==null;){const f=x.index+x[1].length;m.push({startIndex:f,word:v,clickedWordLength:u})}m.reverse().forEach(({startIndex:f,word:g,clickedWordLength:E})=>{c.deleteText(f,E),c.insertText(f,g)}),A(f=>f.filter(g=>g!==n)),T(!1),h(null),W("")},X=()=>{const c=w.current?.getEditor(),d=c.getText();let u=d.indexOf(n);if(u!==-1)for(;u!==-1;)c.formatText(u,n.length,{underline:!1,color:""}),u=d.indexOf(n,u+n.length);h(null),a(s.filter(b=>b!==n)),A(b=>b.filter(x=>x!==n))},Z=async()=>{console.log("Refresh called"),N(!0);const c=w.current?.getEditor();a([]);const d=await ke(c);if(d){const u=Ne(d);A(u),u.forEach(b=>Y(c,b)),a(u)}N(!1)},ge=c=>{c.target.focus()};return e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col w-full max-w-[98vw] xl:max-w-8xl mx-auto p-0 sm:p-1 gap-0.5 sm:gap-1.5 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 pt-1 sm:pt-1.5",children:e.jsx("div",{className:"w-full max-w-5xl mx-auto flex justify-between items-center py-1 gap-3 sm:gap-6",children:e.jsx($e,{text:r,quillRef:w,handleRefresh:Z})})}),e.jsx("div",{className:"flex-1 min-h-0 bg-white rounded-2xl shadow-2xl border border-gray-200/50 overflow-hidden mx-0.5 sm:mx-0 -mt-2",children:e.jsx(pe,{ref:w,value:r,onChange:P,onKeyDown:H,modules:He,className:"h-full w-full",style:{height:"100%",width:"100%",maxWidth:"100%",minHeight:"0"},theme:"snow"})}),R&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200/50 p-6 rounded-2xl shadow-2xl w-full max-w-lg mx-4",children:[e.jsxs("h5",{className:"mb-5 font-bold text-xl text-gray-800",children:["Replace all ",e.jsxs("span",{className:"text-red-500",children:['"',n,'"']}),e.jsxs("span",{className:"text-sm font-normal text-gray-500 block mt-1",children:["(",r.split(new RegExp(n,"gi")).length-1," occurrences)"]})]}),e.jsx("input",{type:"text",autoFocus:!0,value:v,onChange:c=>W(c.target.value),onClick:ge,className:"w-full border-2 border-gray-200 p-4 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all duration-200 text-lg placeholder-gray-400",placeholder:"Type replacement word here..."}),e.jsxs("div",{className:"flex gap-3 justify-end mt-6",children:[e.jsx("button",{onClick:()=>T(!1),className:"px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-all duration-200 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:!v.trim(),className:`px-8 py-3 rounded-xl font-semibold text-lg shadow-lg transition-all duration-200 transform ${v.trim()?"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white hover:shadow-xl hover:-translate-y-0.5 active:scale-95":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Replace All"})]})]})}),n&&i[n]&&e.jsx(_e,{clickedWord:n,suggestions:i,tooltipPosition:j,setClickedWord:h,replaceWord:O,addDictionary:M,replaceAll:S,ignoreAll:X})]}),k&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-40 bg-black/20 backdrop-blur-sm",children:e.jsx(le,{})})]})};export{Nt as default};
