import{a as o,r as l}from"./react-Bl8E5IuX.js";import{Q as u}from"./quill-B46nk1zU.js";import{i as r}from"./lodash-es-CCWjDIKd.js";class a extends o.Component{constructor(t){super(t),this.editingAreaRef=l.createRef(),this.containerRef=l.createRef(),this.dirtyProps=["modules","formats","bounds","theme","children"],this.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],this.state={generation:0},this.selection=null,this.onEditorChange=(i,n,s,h)=>{i==="text-change"?this.onEditorChangeText?.(this.editor.root.innerHTML,n,h,this.unprivilegedEditor):i==="selection-change"&&this.onEditorChangeSelection?.(n,h,this.unprivilegedEditor)};const e=this.isControlled()?t.value:t.defaultValue;this.value=e??""}validateProps(t){if(o.Children.count(t.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(o.Children.count(t.children)&&o.Children.only(t.children)?.type==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.");if(this.lastDeltaChangeSet&&t.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")}shouldComponentUpdate(t,e){if(this.validateProps(t),!this.editor||this.state.generation!==e.generation)return!0;if("value"in t){const i=this.getEditorContents(),n=t.value??"";this.isEqualValue(n,i)||this.setEditorContents(this.editor,n)}return t.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,t.readOnly),[...this.cleanProps,...this.dirtyProps].some(i=>!r(t[i],this.props[i]))}shouldComponentRegenerate(t){return this.dirtyProps.some(e=>!r(t[e],this.props[e]))}componentDidMount(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())}componentWillUnmount(){this.destroyEditor()}componentDidUpdate(t,e){if(this.editor&&this.shouldComponentRegenerate(t)){const i=this.editor.getContents(),n=this.editor.getSelection();this.regenerationSnapshot={delta:i,selection:n},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==e.generation){const{delta:i,selection:n}=this.regenerationSnapshot;delete this.regenerationSnapshot,this.instantiateEditor();const s=this.editor;s.setContents(i),c(()=>this.setEditorSelection(s,n))}}instantiateEditor(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())}destroyEditor(){if(!this.editor)return;this.unhookEditor(this.editor);const t=this.props.modules?.toolbar;if(!(typeof t=="object"&&t&&"container"in t&&typeof t.container=="string"||typeof t=="string")){const i=this.containerRef.current?.querySelector(".ql-toolbar");i&&i.remove()}delete this.editor}isControlled(){return"value"in this.props}getEditorConfig(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,tabIndex:this.props.tabIndex,theme:this.props.theme}}getEditor(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor}createEditor(t,e){const i=new u(t,e);return e.tabIndex!=null&&this.setEditorTabIndex(i,e.tabIndex),this.hookEditor(i),i}hookEditor(t){this.unprivilegedEditor=this.makeUnprivilegedEditor(t),t.on("editor-change",this.onEditorChange)}unhookEditor(t){t.off("editor-change",this.onEditorChange)}getEditorContents(){return this.value}getEditorSelection(){return this.selection}isDelta(t){return t&&t.ops}isEqualValue(t,e){return this.isDelta(t)&&this.isDelta(e)?r(t.ops,e.ops):r(t,e)}setEditorContents(t,e){this.value=e;const i=this.getEditorSelection();typeof e=="string"?t.setContents(t.clipboard.convert({html:e})):t.setContents(e),c(()=>this.setEditorSelection(t,i))}setEditorSelection(t,e){if(this.selection=e,e){const i=t.getLength();e.index=Math.max(0,Math.min(e.index,i-1)),e.length=Math.max(0,Math.min(e.length,i-1-e.index)),t.setSelection(e)}}setEditorTabIndex(t,e){t?.scroll?.domNode&&(t.scroll.domNode.tabIndex=e)}setEditorReadOnly(t,e){e?t.disable():t.enable()}makeUnprivilegedEditor(t){const e=t;return{getHTML:()=>e.root.innerHTML,getSemanticHTML:e.getSemanticHTML.bind(e),getLength:e.getLength.bind(e),getText:e.getText.bind(e),getContents:e.getContents.bind(e),getSelection:e.getSelection.bind(e),getBounds:e.getBounds.bind(e)}}getEditingArea(){const t=this.editingAreaRef.current;if(!t)throw new Error("Cannot find element for editing area");if(t.nodeType===3)throw new Error("Editing area cannot be a text node");return t}renderEditingArea(){const{children:t,preserveWhitespace:e}=this.props,{generation:i}=this.state,n={key:i,ref:this.editingAreaRef};return o.Children.count(t)?o.cloneElement(o.Children.only(t),n):e?o.createElement("pre",{...n}):o.createElement("div",{...n})}render(){return o.createElement("div",{ref:this.containerRef,id:this.props.id,style:this.props.style,key:this.state.generation,className:`quill ${this.props.className??""}`,onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())}onEditorChangeText(t,e,i,n){if(!this.editor)return;const s=this.isDelta(this.value)?n.getContents():n.getHTML();s!==this.getEditorContents()&&(this.lastDeltaChangeSet=e,this.value=s,this.props.onChange?.(t,e,i,n))}onEditorChangeSelection(t,e,i){if(!this.editor)return;const n=this.getEditorSelection(),s=!n&&t,h=n&&!t;r(t,n)||(this.selection=t,this.props.onChangeSelection?.(t,e,i),s?this.props.onFocus?.(t,e,i):h&&this.props.onBlur?.(n,e,i))}focus(){this.editor&&this.editor.focus()}blur(){this.editor&&(this.selection=null,this.editor.blur())}}a.displayName="React Quill";a.Quill=u;a.defaultProps={theme:"snow",modules:{},readOnly:!1};function c(d){Promise.resolve().then(d)}export{a as R};
