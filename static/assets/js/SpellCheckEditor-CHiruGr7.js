import{r as g,j as e}from"./react-87inLI7G.js";import{R as ge}from"./react-quill-new-P7oPFw6w.js";import{u as le,L as ae,a as pe}from"./index-B3hJj7DY.js";import{a as z,R as me,F as he,h as xe,i as Q,j as fe,k as we,I as ye,b as be,l as ee,m as te,n as oe,o as ne,p as se}from"./@mui-BgS5I2ZV.js";import{F as je}from"./file-saver-i-lmDZDm.js";import{m as Ce}from"./quill-to-word-CqsuKUwa.js";import{Q as _}from"./quill-CZy4Qc3w.js";import{E as Ee}from"./jspdf-cGIlQrZ8.js";import Te from"./html2canvas-CBrSDip1.js";import{g as ve,i as Se,c as De,a as ke,r as Ae,b as We}from"./spellcheckApiService-11QcTeX-.js";import{b as Ne}from"./react-router-ri5stJUf.js";import"./@xmldom-DBEIMRBk.js";import"./lodash-BOf1oiLx.js";import"./react-dom-CosTHhxT.js";import"./scheduler-CzFDRTuY.js";import"./react-router-dom-Bk36vaWp.js";import"./@remix-run-CGjFHglr.js";import"./axios-CCb-kr4I.js";import"./@babel-CRFnVEoO.js";import"./fflate-EnPhvkmS.js";import"./react-is-DUDD-a5e.js";import"./clsx-B-dksMZM.js";import"./@emotion-Ca6BSwXP.js";import"./hoist-non-react-statics-DQogQWOa.js";import"./stylis-YPZU7XtI.js";import"./react-transition-group-DGTJP9RM.js";import"./parchment-Crftfyop.js";import"./quill-delta-D6FENnLs.js";import"./fast-diff-Az_-rVRq.js";import"./lodash.clonedeep-Dbfj2Hht.js";import"./lodash.isequal-KULglXUe.js";import"./eventemitter3-DJ6nYskT.js";import"./lodash-es-BKPNmaDy.js";const Y=o=>{const t=new Date,a=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear(),p=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${a}${i}${s}-${p}${l}.${o}`},Re=o=>{const t=document.createElement("div");t.innerHTML=o;const a=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),i=new Blob([a],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=Y("txt"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},Le=async o=>{if(!o){console.error("No content provided for Word download.");return}try{const t=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1"),a=document.createElement("div");a.style.display="none",document.body.appendChild(a);const i=new _(a,{theme:"snow"});i.clipboard.dangerouslyPasteHTML(t);const s=i.getContents(),p={exportAs:"blob"},l=await Ce.generateWord(s,p);je.saveAs(l,Y("docx")),document.body.removeChild(a)}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},Ie=async o=>{try{if(!o)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const a=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=a,document.body.appendChild(t),setTimeout(async()=>{const i=await Te(t,{scale:2}),s=new Ee,p=i.toDataURL("image/png"),l=s.internal.pageSize.getWidth(),v=s.internal.pageSize.getHeight(),n=10,x=l-2*n,C=i.height*x/i.width;if(C>v-2*n){const S=v-2*n,j=i.width*S/i.height;s.addImage(p,"PNG",n,n,j,S)}else s.addImage(p,"PNG",n,n,x,C);s.save(Y("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},ze=({text:o,quillRef:t,handleRefresh:a,handleReset:i})=>{const{language:s}=le(),p={en:{process:"Process",download:"Download",downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",reset:"Reset",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{process:"ಪ್ರಕ್ರಿಯೆ",download:"ಡೌನ್‌ಲೋಡ್",downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",reset:"ಮರುಹೊಂದಿಸಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},l=p[s]||p.en,[v,n]=g.useState(!1),[x,C]=g.useState({open:!1,message:"",type:""}),[S,j]=g.useState(!1),[R,L]=g.useState(!1),[D,T]=g.useState(null),E=async(k,I)=>{if(!o||o.trim()===""||o==="<p><br></p>"){L(!0);return}n(!0);try{await I(),C({open:!0,message:l.downloadSuccess.replace("{type}",k),type:"success"})}catch{C({open:!0,message:l.downloadError.replace("{type}",k),type:"error"})}n(!1)},$=()=>C({...x,open:!1}),M=k=>{T(k.currentTarget)},f=()=>{T(null)},H=()=>{E(".txt",()=>Re(o)),f()},W=()=>{E(".docx",()=>Le(o)),f()},N=()=>{E(".pdf",()=>Ie(o)),f()},P=()=>{var I;const k=(I=t.current)==null?void 0:I.getEditor();k&&k.setText(""),j(!1)},O=()=>{j(!0)},B=()=>{P()},F=()=>{L(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs(z,{variant:"contained",title:l.process,onClick:a,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem",backgroundColor:"green"},children:[e.jsx(me,{fontSize:"small"}),e.jsx("span",{children:l.process})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(z,{variant:"contained",title:l.download,onClick:M,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:l.download})]}),e.jsxs(xe,{anchorEl:D,open:!!D,onClose:f,children:[e.jsx(Q,{onClick:H,children:l.downloadTxt}),e.jsx(Q,{onClick:W,children:l.downloadDocx}),e.jsx(Q,{onClick:N,children:l.downloadPdf})]}),e.jsxs(z,{variant:"contained",title:l.reset,onClick:O,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem",backgroundColor:"red"},children:[e.jsx(fe,{fontSize:"small"}),e.jsx("span",{children:l.reset})]})]}),e.jsx(we,{open:x.open,autoHideDuration:3e3,onClose:$,message:x.message,action:e.jsx(ye,{size:"small","aria-label":"close",color:"inherit",onClick:$,children:e.jsx(be,{fontSize:"small"})}),severity:x.type}),e.jsxs(ee,{open:S,onClose:()=>j(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(te,{id:"alert-dialog-title",children:l.reset}),e.jsx(oe,{children:e.jsx(ne,{id:"alert-dialog-description",children:l.resetConfirmation})}),e.jsxs(se,{children:[e.jsx(z,{onClick:()=>j(!1),color:"primary",children:"Cancel"}),e.jsx(z,{onClick:B,color:"primary",autoFocus:!0,children:"Confirm"})]})]}),e.jsxs(ee,{open:R,onClose:F,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(te,{id:"alert-dialog-title",children:"Error"}),e.jsx(oe,{children:e.jsx(ne,{id:"alert-dialog-description",children:l.emptyTextError})}),e.jsx(se,{children:e.jsx(z,{onClick:F,color:"primary",children:"Close"})})]}),v&&e.jsx(ae,{})]})})},K={correctness:{},suggestions:{}},$e=(o,t,a=[])=>{K.correctness[o]=t,K.suggestions[o]=a},Me=o=>K.suggestions[o]||[],ie=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],ce=_.import("attributors/style/size");ce.whitelist=ie;_.register(ce,!0);const Fe={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:ie}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},re=[".",",","!","?",";",":"],qe=(o,t)=>{let a=t,i=t;for(;a>0&&!/\s/.test(o[a-1])&&!re.includes(o[a-1]);)a--;for(;i<o.length&&!/\s/.test(o[i])&&!re.includes(o[i]);)i++;return o.substring(a,i)},q=(o,t)=>{const a=o.getText(),i=new RegExp(`([^\\w]|^)(${t})([^\\w]|$)`,"g");let s;for(;(s=i.exec(a))!==null;){const l=s.index+s[1].length,v=s[2].length;o.formatText(l,v,{underline:!0})}document.querySelectorAll(".ql-editor u").forEach(l=>{l.innerText.trim()===t&&l.classList.add("red-underline")})},de=document.createElement("style");de.innerHTML=`
  .red-underline {
    text-decoration: underline;
    text-decoration-color: red;  /* Only the underline will be red */
    text-decoration-thickness: 3px;  /* Adjust underline thickness if needed */
  }
`;document.head.appendChild(de);const G=o=>{const t=/[^\w\u0C80-\u0CFF]+/g;return o.replace(t,"")},He=({clickedWord:o,suggestions:t,tooltipPosition:a,setClickedWord:i,replaceWord:s,addDictionary:p,replaceAll:l,ignoreAll:v})=>{var D;const{language:n}=le(),x={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},C=x[n]||x.en,S=g.useRef(null),j=g.useRef(!1);g.useEffect(()=>{const T=E=>{S.current&&!S.current.contains(E.target)&&(j.current||i(null))};return document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[i]);const R=()=>{j.current=!0,l()},L=()=>{i(null)};return e.jsxs("div",{ref:S,className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:a.top+100,left:a.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:L,"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[((D=t[o])==null?void 0:D.length)>0?t[o].map((T,E)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>s(T),children:T}),E<t[o].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},T)):e.jsx("div",{className:"text-gray-500 text-sm",children:C.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:p,children:C.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:R,children:C.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:v,children:C.ignoreAll})]})]})},bt=()=>{var V;const t=((V=Ne().state)==null?void 0:V.uploadedContent)||"",[a,i]=g.useState(""),[s,p]=g.useState([]),[l,v]=g.useState({}),[n,x]=g.useState(null),[C,S]=g.useState({}),[j,R]=g.useState(""),[L,D]=g.useState(!1),[T,E]=g.useState(!1),[$,M]=g.useState(!1),f=g.useRef(null),H=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:W,setWrongWords:N}=pe();g.useEffect(()=>{f.current&&f.current.getEditor().root.setAttribute("spellcheck","false")},[]),g.useEffect(()=>{if(t.length==0){N([]);return}if(t&&(console.log("updating content into editor ...."),i(t)),!W||W.length===0)return;p([]),console.log("Wrong Words Updated:",W.length),console.log("Errors Updated:",s.length),E(!0);const r=setTimeout(()=>{var c;const u=(c=f.current)==null?void 0:c.getEditor();console.log("Underlining the wrong words"),W.forEach(d=>q(u,d)),E(!1)},3e3);return()=>clearTimeout(r)},[t]),g.useEffect(()=>{var h;const r=(h=f.current)==null?void 0:h.getEditor(),u=()=>{M(!0)},c=()=>{M(!1)},d=async(w,m)=>{if($&&w&&w.length===0){const b=r.getText(),y=G(qe(b,w.index));if(y)if(s.includes(y)||W.includes(y)){let A=Me(y);if(A.length===0)try{A=await ve(y),$e(y,!1,A)}catch(U){console.error("Error fetching suggestions:",U)}x(y),v(U=>({...U,[y]:A}));const X=r.getBounds(w.index);S({top:X.bottom+90,left:X.left})}else x(null)}};return document.addEventListener("mousedown",u),document.addEventListener("mouseup",c),r.on("selection-change",d),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("mouseup",c),r.off("selection-change",d)}},[s,$]);const P=r=>{i(r)},O=async r=>{r.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{var d;const u=f.current.getEditor(),c=u.getSelection();if(c){const w=u.getText(0,c.index).trim().split(/\s+/);let m=w[w.length-1].split("").filter(b=>!H.includes(b)).join("");if(Se(m))return;if(s.includes(G(m)))q(u,m);else if(m&&!/^[a-zA-Z0-9]+$/.test(m)&&!(await De(m)).status){p(A=>[...A,m]);const y=(d=f.current)==null?void 0:d.getEditor();q(y,m)}}},300))},B=r=>{const u=f.current.getEditor(),c=u.getText(),d=n.length,h=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let w;const m=[];for(;(w=h.exec(c))!==null;){const b=w.index+w[1].length,y=d;m.push({startIndex:b,length:y})}for(let b=m.length-1;b>=0;b--){const{startIndex:y,length:A}=m[b];u.deleteText(y,A),u.insertText(y,r)}p(s.filter(b=>b!==n)),x(null)},F=async()=>{if(n)try{const r=await ke(G(n));if(r){const u=f.current.getEditor(),c=u.getText();let d=c.indexOf(n);if(d!==-1)for(;d!==-1;)u.formatText(d,n.length,{underline:!1,color:""}),d=c.indexOf(n,d+n.length);N(h=>h.filter(w=>w!==n)),p(s.filter(h=>h!==n)),x(null),console.log(r)}else console.error("Failed to add the word to the dictionary.")}catch(r){console.error("Error adding word to dictionary:",r)}},k=()=>{n&&D(!0)},I=()=>{const r=f.current.getEditor(),u=r.getText(),c=n.length,d=new RegExp(`(\\W|^)(${n})(\\W|$)`,"g");let h;const w=[];for(;(h=d.exec(u))!==null;){const m=h.index+h[1].length;w.push({startIndex:m,word:j,clickedWordLength:c})}w.reverse().forEach(({startIndex:m,word:b,clickedWordLength:y})=>{r.deleteText(m,y),r.insertText(m,b)}),N(m=>m.filter(b=>b!==n)),D(!1),x(null),R("")},Z=()=>{var d;const r=(d=f.current)==null?void 0:d.getEditor(),u=r.getText();let c=u.indexOf(n);if(c!==-1)for(;c!==-1;)r.formatText(c,n.length,{underline:!1,color:""}),c=u.indexOf(n,c+n.length);x(null),p(s.filter(h=>h!==n)),N(h=>h.filter(w=>w!==n))},J=async()=>{var c;console.log("Refresh called"),E(!0);const r=(c=f.current)==null?void 0:c.getEditor();p([]);const u=await Ae(r);if(u){const d=We(u);N(d),d.forEach(h=>q(r,h)),p(d)}E(!1)},ue=r=>{r.target.focus()};return e.jsxs("div",{className:"flex justify-center min-h-screen bg-gray-500 p-3",children:[e.jsxs("div",{className:"w-full max-w-full bg-white rounded-lg shadow-md p-4",children:[" ",e.jsx(ze,{text:a,quillRef:f,handleRefresh:J}),e.jsx(ge,{ref:f,value:a,onChange:P,onKeyDown:O,modules:Fe,className:"",style:{height:"500px",minHeight:"400px",width:"100%"}}),L&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4 rounded shadow-lg w-11/12 max-w-sm mx-auto",children:[e.jsxs("h5",{className:"mb-2",children:["Replace ",n," with:"]}),e.jsx("input",{type:"text",autoFocus:!0,value:j,onChange:r=>R(r.target.value),onClick:ue,className:"border border-gray-300 p-2 rounded w-full",placeholder:"Replacement word"}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{onClick:I,className:`bg-blue-500 text-white px-4 py-2 rounded mr-2 ${j.trim()?"":"opacity-50 cursor-not-allowed"}`,disabled:!j.trim(),children:"Replace All"}),e.jsx("button",{onClick:()=>D(!1),className:"bg-gray-300 px-4 py-2 rounded",children:"Cancel"})]})]})}),n&&l[n]&&e.jsx(He,{clickedWord:n,suggestions:l,tooltipPosition:C,setClickedWord:x,replaceWord:B,addDictionary:F,replaceAll:k,ignoreAll:Z})]}),T&&e.jsx(ae,{})]})};export{bt as default};
