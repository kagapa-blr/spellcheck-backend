import{r as p,j as e}from"./react-Bl8E5IuX.js";import{R as pe}from"./react-quill-new-CyTfg7OS.js";import{u as re,L as le,a as me}from"./index-WeQj1kqw.js";import{a as L,R as he,F as xe,h as fe,i as _,j as we,k as ye,I as be,b as Te,l as J,m as V,n as ee,o as te,p as oe}from"./@mui-CqzUGJzF.js";import{F as ae}from"./file-saver-rnBKeqMz.js";import{E as Ee}from"./jspdf-CWhYFgit.js";import je from"./html2canvas-Ge7aVWlp.js";import{P as ne,T as Q,F as Ce,a as ve}from"./docx-NhmA0v17.js";import{g as Se,r as De,i as Ne,a as ke,c as Ae,b as Re}from"./spellcheckApiService-BKmEpamJ.js";import{Q as ie}from"./quill-B46nk1zU.js";import{b as We}from"./react-router-DeFDwJHZ.js";import"./@xmldom-BKc_IZtg.js";import"./lodash-es-CCWjDIKd.js";import"./react-dom-D2p-lIFc.js";import"./scheduler-CWG1rEj-.js";import"./react-router-dom-BIFhErXW.js";import"./@remix-run-DBs3BZwC.js";import"./axios-B9ygI19o.js";import"./@babel-Bm-97afu.js";import"./fflate-B2WnmEVw.js";import"./fast-png-CMV4RlVR.js";import"./iobuffer-BmLRrqXH.js";import"./react-is-CeStwY2e.js";import"./clsx-B-dksMZM.js";import"./@emotion-DYK3XH82.js";import"./hoist-non-react-statics-BTNdDy0I.js";import"./stylis-DDa9OTMq.js";import"./react-transition-group-CtzHUc09.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-iKGLtRMb.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-D_vhMAuW.js";import"./lodash.isequal-CICIla5N.js";import"./eventemitter3-7hjLPkNj.js";const X=o=>{const t=new Date,l=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${l}${i}${n}-${c}${r}.${o}`},Le=o=>{if(!o)return;const t=document.createElement("div");t.innerHTML=o;const l=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),i=new Blob([l],{type:"text/plain;charset=utf-8"});ae.saveAs(i,X("txt"))},Me=o=>{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const l=[],i=n=>{if(n.nodeType===Node.TEXT_NODE)n.textContent.trim()&&l.push(new Q({text:n.textContent}));else if(n.nodeType===Node.ELEMENT_NODE){const c={};(n.tagName==="B"||n.tagName==="STRONG")&&(c.bold=!0),(n.tagName==="I"||n.tagName==="EM")&&(c.italics=!0),n.tagName==="U"&&(c.underline={}),n.childNodes.length&&n.childNodes.forEach(r=>{r.nodeType===Node.TEXT_NODE?r.textContent.trim()&&l.push(new Q({...c,text:r.textContent})):i(r)})}};return t.childNodes.forEach(i),l},Ie=async o=>{if(!o){console.error("No content provided for Word download.");return}try{const t=document.createElement("div");t.innerHTML=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const l=[];t.childNodes.forEach(c=>{let r="";c.tagName==="BR"?l.push(new ne({children:[new Q({text:""})]})):l.push(new ne({children:Me(c.outerHTML||c.textContent)}))});const i=new Ce({sections:[{properties:{},children:l}]}),n=await ve.toBlob(i);ae.saveAs(n,X("docx"))}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},$e=async o=>{try{if(!o)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const l=o.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=l,document.body.appendChild(t),setTimeout(async()=>{const i=await je(t,{scale:2}),n=new Ee,c=i.toDataURL("image/png"),r=n.internal.pageSize.getWidth(),C=n.internal.pageSize.getHeight(),s=10,x=r-2*s,T=i.height*x/i.width;if(T>C-2*s){const v=C-2*s,b=i.width*v/i.height;n.addImage(c,"PNG",s,s,b,v)}else n.addImage(c,"PNG",s,s,x,T);n.save(X("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},ze=({text:o,quillRef:t,handleRefresh:l,handleReset:i})=>{const{language:n}=re(),c={en:{process:"Process",download:"Download",downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",reset:"Reset",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{process:"ಪ್ರಕ್ರಿಯೆ",download:"ಡೌನ್‌ಲೋಡ್",downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",reset:"ಮರುಹೊಂದಿಸಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},r=c[n]||c.en,[C,s]=p.useState(!1),[x,T]=p.useState({open:!1,message:"",type:""}),[v,b]=p.useState(!1),[R,W]=p.useState(!1),[E,D]=p.useState(null),N=async(S,B)=>{if(!o||o.trim()===""||o==="<p><br></p>"){W(!0);return}s(!0);try{await B(),T({open:!0,message:r.downloadSuccess.replace("{type}",S),type:"success"})}catch{T({open:!0,message:r.downloadError.replace("{type}",S),type:"error"})}s(!1)},M=()=>T({...x,open:!1}),I=S=>{D(S.currentTarget)},f=()=>{D(null)},H=()=>{N(".txt",()=>Le(o)),f()},k=()=>{N(".docx",()=>Ie(o)),f()},A=()=>{N(".pdf",()=>$e(o)),f()},O=()=>{const S=t.current?.getEditor();S&&S.setText(""),b(!1)},P=()=>{b(!0)},q=()=>{O()},$=()=>{W(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs(L,{variant:"contained",title:r.process,onClick:l,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem",backgroundColor:"green"},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:r.process})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(L,{variant:"contained",title:r.download,onClick:I,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem"},children:[e.jsx(xe,{fontSize:"small"}),e.jsx("span",{children:r.download})]}),e.jsxs(fe,{anchorEl:E,open:!!E,onClose:f,children:[e.jsx(_,{onClick:H,children:r.downloadTxt}),e.jsx(_,{onClick:k,children:r.downloadDocx}),e.jsx(_,{onClick:A,children:r.downloadPdf})]}),e.jsxs(L,{variant:"contained",title:r.reset,onClick:P,className:"flex items-center space-x-1",sx:{padding:"6px",fontSize:"0.8rem",backgroundColor:"red"},children:[e.jsx(we,{fontSize:"small"}),e.jsx("span",{children:r.reset})]})]}),e.jsx(ye,{open:x.open,autoHideDuration:3e3,onClose:M,message:x.message,action:e.jsx(be,{size:"small","aria-label":"close",color:"inherit",onClick:M,children:e.jsx(Te,{fontSize:"small"})}),severity:x.type}),e.jsxs(J,{open:v,onClose:()=>b(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{id:"alert-dialog-title",children:r.reset}),e.jsx(ee,{children:e.jsx(te,{id:"alert-dialog-description",children:r.resetConfirmation})}),e.jsxs(oe,{children:[e.jsx(L,{onClick:()=>b(!1),color:"primary",children:"Cancel"}),e.jsx(L,{onClick:q,color:"primary",autoFocus:!0,children:"Confirm"})]})]}),e.jsxs(J,{open:R,onClose:$,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{id:"alert-dialog-title",children:"Error"}),e.jsx(ee,{children:e.jsx(te,{id:"alert-dialog-description",children:r.emptyTextError})}),e.jsx(oe,{children:e.jsx(L,{onClick:$,color:"primary",children:"Close"})})]}),C&&e.jsx(le,{})]})})},K={correctness:{},suggestions:{}},Fe=(o,t,l=[])=>{K.correctness[o]=t,K.suggestions[o]=l},He=o=>K.suggestions[o]||[],ce=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],de=ie.import("attributors/style/size");de.whitelist=ce;ie.register(de,!0);const Oe={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:ce}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},se=[".",",","!","?",";",":"],Pe=(o,t)=>{let l=t,i=t;for(;l>0&&!/\s/.test(o[l-1])&&!se.includes(o[l-1]);)l--;for(;i<o.length&&!/\s/.test(o[i])&&!se.includes(o[i]);)i++;return o.substring(l,i)},F=(o,t)=>{const l=o.getText(),i=new RegExp(`([^\\w]|^)(${t})([^\\w]|$)`,"g");let n;for(;(n=i.exec(l))!==null;){const r=n.index+n[1].length,C=n[2].length;o.formatText(r,C,{underline:!0})}document.querySelectorAll(".ql-editor u").forEach(r=>{r.innerText.trim()===t&&r.classList.add("red-underline")})},ue=document.createElement("style");ue.innerHTML=`
  .red-underline {
    text-decoration: underline;
    text-decoration-color: red;  /* Only the underline will be red */
    text-decoration-thickness: 3px;  /* Adjust underline thickness if needed */
  }
`;document.head.appendChild(ue);const G=o=>{const t=/[^\w\u0C80-\u0CFF]+/g;return o.replace(t,"")},qe=({clickedWord:o,suggestions:t,tooltipPosition:l,setClickedWord:i,replaceWord:n,addDictionary:c,replaceAll:r,ignoreAll:C})=>{const{language:s}=re(),x={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},T=x[s]||x.en,v=p.useRef(null),b=p.useRef(!1);p.useEffect(()=>{const E=D=>{v.current&&!v.current.contains(D.target)&&(b.current||i(null))};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},[i]);const R=()=>{b.current=!0,r()},W=()=>{i(null)};return e.jsxs("div",{ref:v,className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:l.top+100,left:l.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:W,"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[t[o]?.length>0?t[o].map((E,D)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>n(E),children:E}),D<t[o].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},E)):e.jsx("div",{className:"text-gray-500 text-sm",children:T.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:c,children:T.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:R,children:T.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:C,children:T.ignoreAll})]})]})},jt=()=>{const t=We().state?.uploadedContent||"",[l,i]=p.useState(""),[n,c]=p.useState([]),[r,C]=p.useState({}),[s,x]=p.useState(null),[T,v]=p.useState({}),[b,R]=p.useState(""),[W,E]=p.useState(!1),[D,N]=p.useState(!1),[M,I]=p.useState(!1),f=p.useRef(null),H=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:k,setWrongWords:A}=me();p.useEffect(()=>{f.current&&f.current.getEditor().root.setAttribute("spellcheck","false")},[]),p.useEffect(()=>{if(t.length==0){A([]);return}if(t&&(console.log("updating content into editor ...."),i(t)),!k||k.length===0)return;c([]),console.log("Wrong Words Updated:",k.length),console.log("Errors Updated:",n.length),N(!0);const a=setTimeout(()=>{const u=f.current?.getEditor();console.log("Underlining the wrong words"),k.forEach(d=>F(u,d)),N(!1)},3e3);return()=>clearTimeout(a)},[t]),p.useEffect(()=>{const a=f.current?.getEditor(),u=()=>{I(!0)},d=()=>{I(!1)},m=async(h,w)=>{if(M&&h&&h.length===0){const y=a.getText(),g=G(Pe(y,h.index));if(g)if(n.includes(g)||k.includes(g)){let j=He(g);if(j.length===0)try{j=await Se(g),Fe(g,!1,j)}catch(U){console.error("Error fetching suggestions:",U)}x(g),C(U=>({...U,[g]:j}));const z=a.getBounds(h.index);v({top:z.bottom+90,left:z.left})}else x(null)}};return document.addEventListener("mousedown",u),document.addEventListener("mouseup",d),a.on("selection-change",m),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("mouseup",d),a.off("selection-change",m)}},[n,M]);const O=a=>{i(a)},P=async a=>{a.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{const u=f.current.getEditor(),d=u.getSelection();if(d){const h=u.getText(0,d.index).trim().split(/\s+/);let w=h[h.length-1].split("").filter(y=>!H.includes(y)).join("");if(ke(w))return;if(n.includes(G(w)))F(u,w);else if(w&&!/^[a-zA-Z0-9]+$/.test(w)&&!(await Ae(w)).status){c(j=>[...j,w]);const g=f.current?.getEditor();F(g,w)}}},300))},q=a=>{const u=f.current.getEditor(),d=u.getText(),m=s.length,h=new RegExp(`(\\W|^)(${s})(\\W|$)`,"g");let w;const y=[];for(;(w=h.exec(d))!==null;){const g=w.index+w[1].length,j=m;y.push({startIndex:g,length:j})}for(let g=y.length-1;g>=0;g--){const{startIndex:j,length:z}=y[g];u.deleteText(j,z),u.insertText(j,a)}c(n.filter(g=>g!==s)),x(null)},$=async()=>{if(s)try{const a=await Re(G(s));if(a){const u=f.current.getEditor(),d=u.getText();let m=d.indexOf(s);if(m!==-1)for(;m!==-1;)u.formatText(m,s.length,{underline:!1,color:""}),m=d.indexOf(s,m+s.length);A(h=>h.filter(w=>w!==s)),c(n.filter(h=>h!==s)),x(null),console.log(a)}else console.error("Failed to add the word to the dictionary.")}catch(a){console.error("Error adding word to dictionary:",a)}},S=()=>{s&&E(!0)},B=()=>{const a=f.current.getEditor(),u=a.getText(),d=s.length,m=new RegExp(`(\\W|^)(${s})(\\W|$)`,"g");let h;const w=[];for(;(h=m.exec(u))!==null;){const y=h.index+h[1].length;w.push({startIndex:y,word:b,clickedWordLength:d})}w.reverse().forEach(({startIndex:y,word:g,clickedWordLength:j})=>{a.deleteText(y,j),a.insertText(y,g)}),A(y=>y.filter(g=>g!==s)),E(!1),x(null),R("")},Y=()=>{const a=f.current?.getEditor(),u=a.getText();let d=u.indexOf(s);if(d!==-1)for(;d!==-1;)a.formatText(d,s.length,{underline:!1,color:""}),d=u.indexOf(s,d+s.length);x(null),c(n.filter(m=>m!==s)),A(m=>m.filter(h=>h!==s))},Z=async()=>{console.log("Refresh called"),N(!0);const a=f.current?.getEditor();c([]);const u=await De(a);if(u){const d=Ne(u);A(d),d.forEach(m=>F(a,m)),c(d)}N(!1)},ge=a=>{a.target.focus()};return e.jsxs("div",{className:"flex justify-center min-h-screen bg-gray-500 p-3",children:[e.jsxs("div",{className:"w-full max-w-full bg-white rounded-lg shadow-md p-4",children:[" ",e.jsx(ze,{text:l,quillRef:f,handleRefresh:Z}),e.jsx(pe,{ref:f,value:l,onChange:O,onKeyDown:P,modules:Oe,className:"",style:{height:"500px",minHeight:"400px",width:"100%"}}),W&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white border border-gray-300 p-4 rounded shadow-lg w-11/12 max-w-sm mx-auto",children:[e.jsxs("h5",{className:"mb-2",children:["Replace ",s," with:"]}),e.jsx("input",{type:"text",autoFocus:!0,value:b,onChange:a=>R(a.target.value),onClick:ge,className:"border border-gray-300 p-2 rounded w-full",placeholder:"Replacement word"}),e.jsxs("div",{className:"mt-4 flex justify-end",children:[e.jsx("button",{onClick:B,className:`bg-blue-500 text-white px-4 py-2 rounded mr-2 ${b.trim()?"":"opacity-50 cursor-not-allowed"}`,disabled:!b.trim(),children:"Replace All"}),e.jsx("button",{onClick:()=>E(!1),className:"bg-gray-300 px-4 py-2 rounded",children:"Cancel"})]})]})}),s&&r[s]&&e.jsx(qe,{clickedWord:s,suggestions:r,tooltipPosition:T,setClickedWord:x,replaceWord:q,addDictionary:$,replaceAll:S,ignoreAll:Y})]}),D&&e.jsx(le,{})]})};export{jt as default};
