import{a as m,j as e}from"./react-DbtEuUu-.js";import{i as pe}from"./react-quill-new-CsnRHLRG.js";import{u as se,L as le,a as xe}from"./index-8pAsKer9.js";import{a as L,R as me,F as he,h as fe,i as _,j as be,k as we,I as ye,b as ve,l as J,m as V,n as ee,o as te,p as oe}from"./@mui-Q8RKV1MB.js";import{F as ae}from"./file-saver-MsKmXMwP.js";import{E as je}from"./jspdf-DEnQ8Zhn.js";import Ee from"./html2canvas-DXEQVQnt.js";import{P as ne,T as G,F as Te,a as Ce}from"./docx-CTs-IowK.js";import{g as Se,r as ke,i as Ne,a as De,c as Ae,b as We}from"./spellcheckApiService-B4Y14XE6.js";import{Q as ie}from"./quill-BbMqpGUw.js";import{b as Re}from"./react-router-ChRMN3_C.js";import"./lodash-es-CCWjDIKd.js";import"./react-dom-DcXkIZDy.js";import"./scheduler-CWG1rEj-.js";import"./react-router-dom-Cm8LtOuy.js";import"./@remix-run-sy-dwM7X.js";import"./axios-C0Zqfgkc.js";import"./@babel-BUfJX6lK.js";import"./fflate-B2WnmEVw.js";import"./fast-png-RHEe-ix0.js";import"./iobuffer-BmLRrqXH.js";import"./pako-n3Pgozwg.js";import"./clsx-B-dksMZM.js";import"./prop-types-Bw6xMO8O.js";import"./reselect-HBGHfvfV.js";import"./react-is-Rj29YxKv.js";import"./@emotion-CK8GFU5m.js";import"./hoist-non-react-statics-BTNdDy0I.js";import"./stylis-YG1R7XFf.js";import"./@popperjs-DC5wud4b.js";import"./react-transition-group-DV1q_uKQ.js";import"./parchment-DI0xVRB_.js";import"./quill-delta-BqocVgKs.js";import"./fast-diff-BGhgD5-Y.js";import"./lodash.clonedeep-HWw_HLjB.js";import"./lodash.isequal-H8CToeRs.js";import"./eventemitter3-LhCj3FB1.js";const Q=n=>{const t=new Date,s=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear(),l=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0");return`spellcheck-${s}${i}${r}-${l}${a}.${n}`},Le=n=>{if(!n)return;const t=document.createElement("div");t.innerHTML=n;const s=t.innerHTML.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?[^>]+(>|$)/g,""),i=new Blob([s],{type:"text/plain;charset=utf-8"});ae.saveAs(i,Q("txt"))},Me=n=>{const t=document.createElement("div");t.innerHTML=n.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const s=[],i=r=>{if(r.nodeType===Node.TEXT_NODE)r.textContent.trim()&&s.push(new G({text:r.textContent}));else if(r.nodeType===Node.ELEMENT_NODE){const l={};(r.tagName==="B"||r.tagName==="STRONG")&&(l.bold=!0),(r.tagName==="I"||r.tagName==="EM")&&(l.italics=!0),r.tagName==="U"&&(l.underline={}),r.childNodes.length&&r.childNodes.forEach(a=>{a.nodeType===Node.TEXT_NODE?a.textContent.trim()&&s.push(new G({...l,text:a.textContent})):i(a)})}};return t.childNodes.forEach(i),s},$e=async n=>{if(!n){console.error("No content provided for Word download.");return}try{const t=document.createElement("div");t.innerHTML=n.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");const s=[];t.childNodes.forEach(l=>{let a="";l.tagName==="BR"?s.push(new ne({children:[new G({text:""})]})):s.push(new ne({children:Me(l.outerHTML||l.textContent)}))});const i=new Te({sections:[{properties:{},children:s}]}),r=await Ce.toBlob(i);ae.saveAs(r,Q("docx"))}catch(t){console.error("Error generating the Word document:",t),alert("An error occurred while generating the Word document: "+t.message)}},ze=async n=>{try{if(!n)throw new Error("No content provided for PDF download.");const t=document.createElement("div");t.style.position="absolute",t.style.opacity="1",t.style.width="100%",t.style.padding="20px",t.style.boxSizing="border-box";const s=n.replace(/<u class="red-underline">(.+?)<\/u>/g,"$1");t.innerHTML=s,document.body.appendChild(t),setTimeout(async()=>{const i=await Ee(t,{scale:2}),r=new je,l=i.toDataURL("image/png"),a=r.internal.pageSize.getWidth(),T=r.internal.pageSize.getHeight(),o=10,f=a-2*o,v=i.height*f/i.width;if(v>T-2*o){const C=T-2*o,y=i.width*C/i.height;r.addImage(l,"PNG",o,o,y,C)}else r.addImage(l,"PNG",o,o,f,v);r.save(Q("pdf")),document.body.removeChild(t)},100)}catch(t){console.error("Error downloading as PDF:",t),alert("An error occurred: "+t.message)}},Ie=({text:n,quillRef:t,handleRefresh:s,handleReset:i})=>{const{language:r}=se(),l={en:{process:"Process",download:"Download",downloadTxt:"Download .txt",downloadDocx:"Download .docx",downloadPdf:"Download .pdf",reset:"Reset",downloadSuccess:"Downloaded {type}!",downloadError:"Failed to download {type}",downloading:"Downloading...",resetConfirmation:"Are you sure you want to reset the editor? This cannot be undone.",emptyTextError:"Text is empty. Please add content before downloading."},kn:{process:"ಪ್ರಕ್ರಿಯೆ",download:"ಡೌನ್‌ಲೋಡ್",downloadTxt:".txt ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadDocx:".docx ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",downloadPdf:".pdf ರೂಪದಲ್ಲಿ ಡೌನ್‌ಲೋಡ್ ಮಾಡಿ",reset:"ಮರುಹೊಂದಿಸಿ",downloadSuccess:"{type} ಯಶಸ್ವಿಯಾಗಿ ಡೌನ್‌ಲೋಡ್!",downloadError:"{type} ಡೌನ್‌ಲೋಡ್ ವಿಫಲವಾಗಿದೆ",downloading:"ಡೌನ್‌ಲೋಡ್ ಆಗುತ್ತಿದೆ...",resetConfirmation:"ನೀವು ಸಂಪಾದಕವನ್ನು ಮರುಹೊಂದಿಸಲು ಖಚಿತವಾಗಿದ್ದೀರಾ? ಹಿಂತಿರುಗಿಸಲು ಸಾಧ್ಯವಿಲ್ಲ.",emptyTextError:"ಪಠ್ಯ ಖಾಲಿ. ಡೌನ್‌ಲೋಡ್ ಮಾಡಲು ವಿಷಯ ಸೇರಿಸಿ."}},a=l[r]||l.en,[T,o]=m.useState(!1),[f,v]=m.useState({open:!1,message:"",type:""}),[C,y]=m.useState(!1),[W,R]=m.useState(!1),[j,k]=m.useState(null),N=async(S,B)=>{if(!n||n.trim()===""||n==="<p><br></p>"){R(!0);return}o(!0);try{await B(),v({open:!0,message:a.downloadSuccess.replace("{type}",S),type:"success"})}catch{v({open:!0,message:a.downloadError.replace("{type}",S),type:"error"})}o(!1)},M=()=>v({...f,open:!1}),$=S=>{k(S.currentTarget)},w=()=>{k(null)},H=()=>{N(".txt",()=>Le(n)),w()},D=()=>{N(".docx",()=>$e(n)),w()},A=()=>{N(".pdf",()=>ze(n)),w()},P=()=>{const S=t.current?.getEditor();S&&S.setText(""),y(!1)},O=()=>{y(!0)},q=()=>{P()},z=()=>{R(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center w-full pl-0 pr-8 sm:pr-12 justify-start gap-0",children:[e.jsxs(L,{variant:"contained",onClick:s,className:"!flex !items-center !space-x-1.5 min-w-0 ml-4 sm:ml-6",sx:{padding:"8px 12px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #10b981, #059669)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(me,{fontSize:"small"}),e.jsx("span",{children:a.process})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(L,{variant:"contained",onClick:$,className:"!flex !items-center !space-x-1.5 mr-2",sx:{padding:"8px 16px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #1d4ed8, #1e40af)",boxShadow:"0 6px 20px rgba(59, 130, 246, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(he,{fontSize:"small"}),e.jsx("span",{children:a.download})]}),e.jsxs(fe,{anchorEl:j,open:!!j,onClose:w,slotProps:{paper:{sx:{mt:1,minWidth:180}}},children:[e.jsx(_,{onClick:H,sx:{py:1.5},children:a.downloadTxt}),e.jsx(_,{onClick:D,sx:{py:1.5},children:a.downloadDocx}),e.jsx(_,{onClick:A,sx:{py:1.5},children:a.downloadPdf})]}),e.jsxs(L,{variant:"contained",onClick:O,className:"!flex !items-center !space-x-1.5 mr-4 sm:mr-6",sx:{padding:"8px 12px",fontSize:"0.85rem",height:"40px",background:"linear-gradient(135deg, #ef4444, #dc2626)",boxShadow:"0 4px 12px rgba(239, 68, 68, 0.3)","&:hover":{background:"linear-gradient(135deg, #dc2626, #b91c1c)",boxShadow:"0 6px 20px rgba(239, 68, 68, 0.4)",transform:"translateY(-1px)"}},children:[e.jsx(be,{fontSize:"small"}),e.jsx("span",{children:a.reset})]})]}),e.jsx(we,{open:f.open,autoHideDuration:4e3,onClose:M,message:f.message,action:e.jsx(ye,{size:"small","aria-label":"close",color:"inherit",onClick:M,children:e.jsx(ve,{fontSize:"small"})}),severity:f.type,sx:{"& .MuiSnackbarContent-root":{backgroundColor:f.type==="success"?"#10b981":"#ef4444"}}}),e.jsxs(J,{open:C,onClose:()=>y(!1),children:[e.jsx(V,{children:a.reset}),e.jsx(ee,{children:e.jsx(te,{children:a.resetConfirmation})}),e.jsxs(oe,{children:[e.jsx(L,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(L,{onClick:q,variant:"contained",color:"error",children:"Confirm"})]})]}),e.jsxs(J,{open:W,onClose:z,children:[e.jsx(V,{children:"Error"}),e.jsx(ee,{children:e.jsx(te,{children:a.emptyTextError})}),e.jsx(oe,{children:e.jsx(L,{onClick:z,children:"Close"})})]}),T&&e.jsx(le,{})]})})},K={correctness:{},suggestions:{}},Fe=(n,t,s=[])=>{K.correctness[n]=t,K.suggestions[n]=s},He=n=>K.suggestions[n]||[],ce=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","26px","28px","36px","48px"],de=ie.import("attributors/style/size");de.whitelist=ce;ie.register(de,!0);const Pe={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image","video","formula"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:ce}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},re=[".",",","!","?",";",":"],Oe=(n,t)=>{let s=t,i=t;for(;s>0&&!/\s/.test(n[s-1])&&!re.includes(n[s-1]);)s--;for(;i<n.length&&!/\s/.test(n[i])&&!re.includes(n[i]);)i++;return n.substring(s,i)},F=(n,t)=>{const s=n.getText(),i=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`([^\\w]|^)(${i})([^\\w]|$)`,"g");let l;for(;(l=r.exec(s))!==null;){const a=l.index+l[1].length,T=l[2].length;n.formatText(a,T,{underline:!0})}requestAnimationFrame(()=>{const a=document.querySelector(".ql-editor");a&&a.querySelectorAll("u").forEach(o=>{!o.classList.contains("red-underline")&&o.textContent.trim()===t&&o.classList.add("red-underline")})})},ue=document.createElement("style");ue.innerHTML=`
  .red-underline {
    text-decoration: underline;
    text-decoration-color: red;  /* Only the underline will be red */
    text-decoration-thickness: 3px;  /* Adjust underline thickness if needed */
  }
`;document.head.appendChild(ue);const Y=n=>{const t=/[^\w\u0C80-\u0CFF]+/g;return n.replace(t,"")},qe=({clickedWord:n,suggestions:t,tooltipPosition:s,setClickedWord:i,replaceWord:r,addDictionary:l,replaceAll:a,ignoreAll:T})=>{const{language:o}=se(),f={en:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"No suggestions available."},kn:{addToDictionary:"Add to Dictionary",replaceAll:"Replace All",ignoreAll:"Ignore All",noSuggestions:"ಯಾವುದೇ ಸಲಹೆಗಳಿಲ್ಲ"}},v=f[o]||f.en,C=m.useRef(null),y=m.useRef(!1);m.useEffect(()=>{const j=k=>{C.current&&!C.current.contains(k.target)&&(y.current||i(null))};return document.addEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}},[i]);const W=()=>{y.current=!0,a()},R=()=>{i(null)};return e.jsxs("div",{ref:C,className:"absolute bg-white border border-green-900 p-2 mt-16 rounded shadow-lg z-40",style:{top:s.top,left:s.left,minWidth:"150px"},children:[e.jsx("span",{className:"absolute top-0 right-2 cursor-pointer text-red-600 hover:bg-gray-600 text-3xl",onClick:R,"aria-label":"Close",children:"×"}),e.jsxs("div",{className:"mt-3 space-y-0.5",children:[t[n]?.length>0?t[n].map((j,k)=>e.jsxs("div",{children:[e.jsx("div",{className:"cursor-pointer text-green-700 hover:bg-gray-200 text-sm hover:font-bold",onClick:()=>r(j),children:j}),k<t[n].length-1&&e.jsx("hr",{className:"my-0 border-t border-gray-300"})]},j)):e.jsx("div",{className:"text-gray-500 text-sm",children:v.noSuggestions}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:l,children:v.addToDictionary}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:W,children:v.replaceAll}),e.jsx("hr",{className:"my-1 border-t border-gray-300"}),e.jsx("div",{className:"cursor-pointer text-black hover:bg-gray-200 text-sm hover:font-bold",onClick:T,children:v.ignoreAll})]})]})},St=()=>{const t=Re().state?.uploadedContent||"",[s,i]=m.useState(""),[r,l]=m.useState([]),[a,T]=m.useState({}),[o,f]=m.useState(null),[v,C]=m.useState({}),[y,W]=m.useState(""),[R,j]=m.useState(!1),[k,N]=m.useState(!1),[M,$]=m.useState(!1),w=m.useRef(null),H=`!@#$%^&*()_+[]{}|;:',.<>/?~-=\\"`,{wrongWords:D,setWrongWords:A}=xe();m.useEffect(()=>{w.current&&w.current.getEditor().root.setAttribute("spellcheck","false")},[]),m.useEffect(()=>{if(t.length==0){A([]);return}if(t&&(console.log("updating content into editor ...."),i(t)),!D||D.length===0)return;l([]),console.log("Wrong Words Updated:",D.length),console.log("Errors Updated:",r.length),N(!0);const c=setTimeout(()=>{const g=w.current?.getEditor();console.log("Underlining the wrong words");const d=new Set;D.forEach(x=>{d.has(x)||(F(g,x),d.add(x))}),N(!1)},2e3);return()=>clearTimeout(c)},[t]),m.useEffect(()=>{const c=w.current?.getEditor(),g=()=>{$(!0)},d=()=>{$(!1)},x=async(u,h)=>{if(M&&u&&u.length===0){const b=c.getText(),p=Y(Oe(b,u.index));if(p)if(r.includes(p)||D.includes(p)){let E=He(p);if(E.length===0)try{E=await Se(p),Fe(p,!1,E)}catch(U){console.error("Error fetching suggestions:",U)}f(p),T(U=>({...U,[p]:E}));const I=c.getBounds(u.index);C({top:I.bottom+90,left:I.left})}else f(null)}};return document.addEventListener("mousedown",g),document.addEventListener("mouseup",d),c.on("selection-change",x),()=>{document.removeEventListener("mousedown",g),document.removeEventListener("mouseup",d),c.off("selection-change",x)}},[r,M]);const P=c=>{i(c)},O=async c=>{c.key===" "&&(clearTimeout(window.debounceTimer),window.debounceTimer=setTimeout(async()=>{const g=w.current.getEditor(),d=g.getSelection();if(d){const u=g.getText(0,d.index).trim().split(/\s+/);let h=u[u.length-1].split("").filter(b=>!H.includes(b)).join("");if(De(h))return;if(r.includes(Y(h)))F(g,h);else if(h&&!/^[a-zA-Z0-9]+$/.test(h)&&!(await Ae(h)).status){l(E=>[...E,h]);const p=w.current?.getEditor();F(p,h)}}},300))},q=c=>{const g=w.current.getEditor(),d=g.getText(),x=o.length,u=new RegExp(`(\\W|^)(${o})(\\W|$)`,"g");let h;const b=[];for(;(h=u.exec(d))!==null;){const p=h.index+h[1].length,E=x;b.push({startIndex:p,length:E})}for(let p=b.length-1;p>=0;p--){const{startIndex:E,length:I}=b[p];g.deleteText(E,I),g.insertText(E,c)}l(r.filter(p=>p!==o)),f(null)},z=async()=>{if(o)try{const c=Y(o),g=await We([c]);if(g){const d=w.current?.getEditor();if(!d)return;const x=d.getText();let u=x.indexOf(o);for(;u!==-1;)d.formatText(u,o.length,{underline:!1,color:""}),u=x.indexOf(o,u+o.length);A(h=>h.filter(b=>b!==o)),l(h=>h.filter(b=>b!==o)),f(null),console.log("Word added to dictionary:",g)}else console.error("Failed to add the word to the dictionary.")}catch(c){console.error("Error adding word to dictionary:",c)}},S=()=>{o&&j(!0)},B=()=>{const c=w.current.getEditor(),g=c.getText(),d=o.length,x=new RegExp(`(\\W|^)(${o})(\\W|$)`,"g");let u;const h=[];for(;(u=x.exec(g))!==null;){const b=u.index+u[1].length;h.push({startIndex:b,word:y,clickedWordLength:d})}h.reverse().forEach(({startIndex:b,word:p,clickedWordLength:E})=>{c.deleteText(b,E),c.insertText(b,p)}),A(b=>b.filter(p=>p!==o)),j(!1),f(null),W("")},X=()=>{const c=w.current?.getEditor(),g=c.getText();let d=g.indexOf(o);if(d!==-1)for(;d!==-1;)c.formatText(d,o.length,{underline:!1,color:""}),d=g.indexOf(o,d+o.length);f(null),l(r.filter(x=>x!==o)),A(x=>x.filter(u=>u!==o))},Z=async()=>{console.log("Refresh called"),N(!0);const c=w.current?.getEditor();l([]);const g=await ke(c);if(g){const d=Ne(g);A(d);const x=new Set;d.forEach(u=>{x.has(u)||(F(c,u),x.add(u))}),l(d)}N(!1)},ge=c=>{c.target.focus()};return e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[e.jsxs("div",{className:"flex-1 flex flex-col w-full max-w-[98vw] xl:max-w-8xl mx-auto p-0 sm:p-1 gap-0.5 sm:gap-1.5 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 pt-1 sm:pt-1.5 relative z-20",children:e.jsx("div",{className:"w-full max-w-5xl mx-auto flex justify-between items-center py-1 gap-3 sm:gap-6",children:e.jsx(Ie,{text:s,quillRef:w,handleRefresh:Z})})}),e.jsx("div",{className:"flex-1 min-h-0 bg-white rounded-2xl shadow-2xl border border-gray-200/50 overflow-hidden mx-0.5 sm:mx-0",children:e.jsx(pe,{ref:w,value:s,onChange:P,onKeyDown:O,modules:Pe,className:"h-full w-full",style:{height:"100%",width:"100%",maxWidth:"100%",minHeight:"0"},theme:"snow"})}),R&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black/40 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200/50 p-6 rounded-2xl shadow-2xl w-full max-w-lg mx-4",children:[e.jsxs("h5",{className:"mb-5 font-bold text-xl text-gray-800",children:["Replace all ",e.jsxs("span",{className:"text-red-500",children:['"',o,'"']}),e.jsxs("span",{className:"text-sm font-normal text-gray-500 block mt-1",children:["(",s.split(new RegExp(o,"gi")).length-1," occurrences)"]})]}),e.jsx("input",{type:"text",autoFocus:!0,value:y,onChange:c=>W(c.target.value),onClick:ge,className:"w-full border-2 border-gray-200 p-4 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all duration-200 text-lg placeholder-gray-400",placeholder:"Type replacement word here..."}),e.jsxs("div",{className:"flex gap-3 justify-end mt-6",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-8 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-xl transition-all duration-200 shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:B,disabled:!y.trim(),className:`px-8 py-3 rounded-xl font-semibold text-lg shadow-lg transition-all duration-200 transform ${y.trim()?"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white hover:shadow-xl hover:-translate-y-0.5 active:scale-95":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:"Replace All"})]})]})}),o&&a[o]&&e.jsx(qe,{clickedWord:o,suggestions:a,tooltipPosition:v,setClickedWord:f,replaceWord:q,addDictionary:z,replaceAll:S,ignoreAll:X})]}),k&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-40 bg-black/20 backdrop-blur-sm",children:e.jsx(le,{})})]})};export{St as default};
